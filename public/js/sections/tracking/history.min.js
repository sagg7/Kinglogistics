(()=>{const o=o=>{let a={position:o.position,map:e,animation:google.maps.Animation.DROP,icon:{url:"/images/app/tracking/icons/delivery-truck.svg",scaledSize:new google.maps.Size(40,40)}};const n=new google.maps.Marker(a);s.push({driver:o.driver,carrier:o.carrier,load:{id:o.load},coords:`${o.position.lat}, ${o.position.lng}`,marker:n});const t=s.length-1;return n.addListener("click",(()=>{(o=>{const a=s[o];a.infowindow?a.infowindow.open({anchor:a.marker,map:e,shouldFocus:!0}):$.ajax({url:"/tracking/getPinLoadData",type:"GET",data:{load:a.load.id},success:o=>{const n=(o.shipper.name?`<p><strong>Shipper:</strong> ${o.shipper.name}</p>`:"")+`<p><strong>Status:</strong> ${t=o.status,"to_location"===t&&(t="in transit"),t.charAt(0).toUpperCase()+t.slice(1)}<br>`+(o.origin?`<strong>Origin:</strong> ${o.origin}<br><strong>Destination:</strong> ${o.destination}</p>`:"")+`<strong>Driver:</strong> ${a.driver.name}<br>`+`<strong>Truck#:</strong> ${o.truck.number}</p>`+`<strong>Coords:</strong> ${a.coords}</p>`;var t;const r=new google.maps.InfoWindow({content:n});a.infowindow=r,r.open({anchor:a.marker,map:e,shouldFocus:!0})},error:()=>{throwErrorMsg()}})})(t)})),n},e=new google.maps.Map(document.getElementById("map"),{center:{lat:39.8097343,lng:-98.5556199},zoom:10,disableDefaultUI:!0,zoomControl:!0,fullscreenControl:!0}),a=new google.maps.LatLngBounds;if(company){const o=(company.name?`<p><strong>Company:</strong> ${company.name}</p>`:"")+(company.contact_phone?`<p></p><strong>Phone:</strong> ${company.contact_phone}</p>`:"")+(company.email?`<p></p><strong>Email:</strong> ${company.email}</p>`:"")+(company.address?`<p></p><strong>Address:</strong> ${company.address}</p>`:""),n=new google.maps.InfoWindow({content:o}),t=company.location.split(","),r={position:{lat:Number(t[0]),lng:Number(t[1])},map:e,animation:google.maps.Animation.DROP,icon:{url:"/images/app/logos/logo-dark-simple.png",scaledSize:new google.maps.Size(30,30)}},s=new google.maps.Marker(r);s.addListener("click",(()=>{n.open({anchor:s,map:e,shouldFocus:!0})})),a.extend(s.position)}const n=$("#dateRange");n.daterangepicker({format:"YYYY/MM/DD",locale:dateRangeLocale,startDate:moment().startOf("month"),endDate:moment().endOf("month")},((o,e,a)=>{i(o,e)}));const t=$("[name=driver]");t.select2({placeholder:"Select",allowClear:!0}).on("select2:select",(o=>{const a=Number(o.params.data.id);s.forEach((o=>{o.driver.id!==a?o.marker.setMap(null):o.marker.setMap(e)}))})).on("select2:unselect",(()=>{s.forEach((o=>{o.marker.setMap(e)}))}));let r=[];const s=[],i=(i=n.data().daterangepicker.startDate,p=n.data().daterangepicker.endDate)=>{r=[],s.forEach((o=>{o.marker.setMap(null)})),s.length=0,$.ajax({url:"/tracking/historyData",type:"GET",data:{start:i.format("YYYY/MM/DD"),end:p.format("YYYY/MM/DD")},success:n=>{r=n,(()=>{t.html("<option></option>").trigger("change");let n=[];r.forEach((t=>{n.push({id:t.id,text:t.name});const r=t.locations,s=t.carrier,i=[];r.forEach(((o,e)=>{const n={lat:Number(o.latitude),lng:Number(o.longitude)},r=i.find((e=>e.id===o.load_id));r?r.data.push(n):i.push({id:o.load_id,data:[n],driver:{id:t.id,name:t.name},carrier:{id:s.id,name:s.name}}),a.extend(n)})),i.forEach((a=>{const n=a.data;n.length>1&&new google.maps.Polyline({path:n,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2}).setMap(e);const t={position:n[n.length-1],driver:a.driver,carrier:a.carrier,load:a.id};o(t)}))})),n.forEach((o=>{t.append(`<option value="${o.id}">${o.text}</option>`)})),t.trigger("change"),a.isEmpty()?e.setZoom(6):e.fitBounds(a)})()},error:()=>{throwErrorMsg()}})};i()})();

(()=>{const o=o=>{const e={lat:Number(o.coords.latitude),lng:Number(o.coords.longitude)},r=(o.shippers.name?`<p><strong>Shipper:</strong> ${o.shippers.name}</p>`:"")+`<p><strong>Status:</strong> ${a=o.status,"to_location"===a&&(a="in transit"),a.charAt(0).toUpperCase()+a.slice(1)}<br>`+(o.load.origin?`<strong>Origin:</strong> ${o.load.origin}<br><strong>Destination:</strong> ${o.load.destination}</p>`:"")+`<strong>Driver:</strong> ${o.driver.name}<br>`+(o.truck.number?`<strong>Truck#:</strong> ${o.truck.number}`:"")+"</p><strong>MPH:</strong> 0</p>"+`<strong>Date:</strong> ${moment(o.date).format("MM/DD/YYYY HH:mm")}<br>`;var a;const i=new google.maps.InfoWindow({content:r});let s="/images/app/tracking/icons/";o.driver.shift?o.load.origin?s+="truck-green.svg":s+="delivery-truck.svg":s+="truck-red.svg";let m={position:e,map:n,animation:google.maps.Animation.DROP,icon:{url:s,scaledSize:new google.maps.Size(40,40)}};const d=new google.maps.Marker(m);return d.addListener("click",(()=>{i.open({anchor:d,map:n,shouldFocus:!0})})),t.push({load:{id:o.load.id},driver:{id:o.driver.id},marker:d}),d},n=new google.maps.Map(document.getElementById("map"),{center:{lat:39.8097343,lng:-98.5556199},zoom:10,disableDefaultUI:!0,zoomControl:!0,fullscreenControl:!0}),e=new google.maps.LatLngBounds;if(company){const o=(company.name?`<p><strong>Company:</strong> ${company.name}</p>`:"")+(company.contact_phone?`<p></p><strong>Phone:</strong> ${company.contact_phone}</p>`:"")+(company.email?`<p></p><strong>Email:</strong> ${company.email}</p>`:"")+(company.address?`<p></p><strong>Address:</strong> ${company.address}</p>`:""),t=new google.maps.InfoWindow({content:o}),r=company.location.split(","),a={position:{lat:Number(r[0]),lng:Number(r[1])},map:n,animation:google.maps.Animation.DROP,icon:{url:"/images/app/logos/logo-dark-simple.png",scaledSize:new google.maps.Size(35,35)}},i=new google.maps.Marker(a);i.addListener("click",(()=>{t.open({anchor:i,map:n,shouldFocus:!0})})),e.extend(i.position)}let t=[];data.forEach((n=>{const t=n.carrier,r={driver:{id:n.id,name:n.name,shift:n.shift?n.shift.id:null},truck:{number:n.truck_number?n.truck_number:null},carrier:{id:t.id,name:t.name},shippers:{id:n.shipper_id,name:n.shipper_name},coords:{latitude:Number(n.latitude),longitude:Number(n.longitude)},load:{origin:n.origin,destination:n.destination},status:n.location_status,date:moment(n.location_date).format("MM/DD/YYYY HH:mm")},a=o(r);e.extend(a.position)})),e.isEmpty()?n.setZoom(6):n.fitBounds(e),window.Echo.private(channel).listen(echoEvent,(e=>{e.date=moment().format("MM/DD/YYYY HH:mm");let r=t.find((o=>o.driver.id===e.driver.id));r?(r.marker.setPosition({lat:Number(e.coords.latitude),lng:Number(e.coords.longitude)}),r.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout((()=>{r.marker.setAnimation(null)}),600)):o(e);const a=new google.maps.LatLngBounds;t.forEach((o=>{const n=o.marker;a.extend(n.position)})),n.fitBounds(a)}))})();

(()=>{const o=o=>{const e={lat:Number(o.coords.latitude),lng:Number(o.coords.longitude)},i=(o.shippers.name?`<p><strong>Shipper:</strong> ${o.shippers.name}</p>`:"")+`<p><strong>Status:</strong> ${r=o.status,"to_location"===r&&(r="in transit"),r.charAt(0).toUpperCase()+r.slice(1)}<br>`+(o.load.origin?`<strong>Origin:</strong> ${o.load.origin}<br><strong>Destination:</strong> ${o.load.destination}</p>`:"")+`<p><strong>Carrier:</strong> ${o.carrier.name}<br>`+`<strong>Driver:</strong> ${o.driver.name}<br>`+`<strong>Truck#:</strong> ${o.truck.number}</p>`;var r;const a=new google.maps.InfoWindow({content:i});let s={position:e,map:n,animation:google.maps.Animation.DROP,icon:{url:"/images/app/tracking/icons/delivery-truck.svg",scaledSize:new google.maps.Size(50,50),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,0)}};const p=new google.maps.Marker(s);return p.addListener("click",(()=>{a.open({anchor:p,map:n,shouldFocus:!0})})),t.push({load:{id:o.load.id},driver:{id:o.driver.id},marker:p}),p},n=new google.maps.Map(document.getElementById("map"),{center:{lat:39.8097343,lng:-98.5556199},zoom:10,disableDefaultUI:!0,zoomControl:!0,fullscreenControl:!0}),e=new google.maps.LatLngBounds;if(company){const o=(company.name?`<p><strong>Company:</strong> ${company.name}</p>`:"")+(company.contact_phone?`<p></p><strong>Phone:</strong> ${company.contact_phone}</p>`:"")+(company.email?`<p></p><strong>Email:</strong> ${company.email}</p>`:"")+(company.address?`<p></p><strong>Address:</strong> ${company.address}</p>`:""),t=new google.maps.InfoWindow({content:o}),i=company.location.split(","),r={position:{lat:Number(i[0]),lng:Number(i[1])},map:n,animation:google.maps.Animation.DROP,icon:{url:"/images/app/tracking/icons/office-building.svg",scaledSize:new google.maps.Size(50,50),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,0)}},a=new google.maps.Marker(r);a.addListener("click",(()=>{t.open({anchor:a,map:n,shouldFocus:!0})})),e.extend(a.position)}let t=[];data.forEach((n=>{const t=n.latest_location,i=t.parent_load?t.parent_load:{},r=i.shipper?i.shipper:{},a=i.truck?i.truck:n.truck,s=n.carrier,p={driver:{id:n.id,name:n.name},truck:{number:a.number},carrier:{id:s.id,name:s.name},shippers:{id:r.id,name:r.name},coords:{latitude:Number(t.latitude),longitude:Number(t.longitude)},load:{origin:i.origin,destination:i.destination},status:t.status},g=o(p);e.extend(g.position)})),e.isEmpty()?n.setZoom(6):n.fitBounds(e),window.Echo.private(channel).listen(echoEvent,(e=>{let i=t.find((o=>o.driver.id===e.driver.id));i?(i.marker.setPosition({lat:Number(e.coords.latitude),lng:Number(e.coords.longitude)}),i.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout((()=>{i.marker.setAnimation(null)}),600)):o(e);const r=new google.maps.LatLngBounds;t.forEach((o=>{const n=o.marker;r.extend(n.position)})),n.fitBounds(r)}))})();

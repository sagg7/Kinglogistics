(()=>{const e=$("#date"),a=initPickadate(e).pickadate("picker"),t=$("#load_type_id"),r=$("#load_type_shipper"),i=$("#shipper_id"),l=$("#trip_id"),o=$("#origin_id"),d=$("#destination_id"),s=$("#customer_name"),n=$("[name=origin]"),p=$("[name=origin_coords]"),c=$("[name=destination]"),g=$("[name=destination_coords]"),h=$("#mileage");if("undefined"==typeof readOnly){let m=i.length>0?i.val():null;t.select2({ajax:{url:"/loadType/selection",data:e=>({search:e.term,page:e.page||1,take:15,shipper:m})},placeholder:"Select",allowClear:!0}),l.select2({ajax:{url:"/trip/selection",data:e=>({search:e.term,page:e.page||1,take:15,shipper:m})},placeholder:"Select",allowClear:!0}).on("select2:select",(e=>{$.ajax({url:"/trip/getTrip",type:"GET",data:{id:e.params.data.id},success:e=>{n.val(e.trip_origin?e.trip_origin.name:""),p.val(e.trip_origin?e.trip_origin.coords:"").trigger("change"),c.val(e.trip_destination?e.trip_destination.name:""),g.val(e.trip_destination?e.trip_destination.coords:"").trigger("change"),s.val(e.customer_name),h.val(e.mileage),e.trip_origin&&(o.append(`<option value="${e.trip_origin.id}">${e.trip_origin.name}</option>`),o.val(e.trip_origin.id).prop("disabled",!0)),e.trip_destination&&(d.append(`<option value="${e.trip_destination.id}">${e.trip_destination.name}</option>`),d.val(e.trip_destination.id).prop("disabled",!0))},error:()=>{throwErrorMsg()}})})).on("select2:unselect",(()=>{o.val("").prop("disabled",!1).trigger("change"),d.val("").prop("disabled",!1).trigger("change")})),o.select2({ajax:{url:"/trip/origin/selection",data:e=>({search:e.term,page:e.page||1,take:15})},placeholder:"Select",allowClear:!0}).on("select2:select",(e=>{const a=e.params.data;n.val(a.text),p.val(a.coords).trigger("change"),l.prop("disabled",!0)})).on("select2:unselect",(()=>{l.prop("disabled",!1)})),d.select2({ajax:{url:"/trip/destination/selection",data:e=>({search:e.term,page:e.page||1,take:15})},placeholder:"Select",allowClear:!0}).on("select2:select",(e=>{const a=e.params.data;c.val(a.text),g.val(a.coords).trigger("change"),l.prop("disabled",!0)})).on("select2:unselect",(()=>{l.prop("disabled",!1)})),i.length>0&&(i.select2({ajax:{url:"/shipper/selection",data:e=>({search:e.term,page:e.page||1,take:15})},placeholder:"Select",allowClear:!0}).on("select2:select",(e=>{m=e.params.data.id,r.val(m),t.prop("disabled",!1).trigger("change"),l.prop("disabled",!1).trigger("change")})).on("select2:unselect",(()=>{r.val(""),t.val("").prop("disabled",!0).trigger("change"),l.val("").prop("disabled",!0).trigger("change")})),t.val()||i.val()||t.prop("disabled",!0).trigger("change")),a.set("select",e.val(),{format:"yyyy/mm/dd"}),$("#deleteLoadType").on("show.bs.modal",(e=>{let a=$("#load_type_id").html(),t=$("#delete_type");deleteHandler(t,a)})),(i.length>0&&!i.val()||o.val()||d.val())&&l.prop("disabled",!0).trigger("change"),l.val()&&(o.prop("disabled",!0),d.prop("disabled",!0));const v=$("#createLoadModal");v.length>0&&(v.on("hidden.modal.bs",(()=>{v.find("input, select, textarea").val("").trigger("change"),v.find("#shipper_id").trigger("select2:unselect")})),$("#loadForm").submit((e=>{e.preventDefault();const a=$(e.currentTarget),t=new FormData(a[0]),r=a.attr("action");$.ajax({url:r,type:"POST",data:t,contentType:!1,processData:!1,success:e=>{e.success?("finished"===t.get("notes")?tbLoadActive.updateSearchQuery():tbLoadFinished.updateSearchQuery(),v.modal("hide")):throwErrorMsg()},error:e=>{let a='<ul class="text-left">';Object.values(e.responseJSON.errors).forEach((e=>{e.forEach((e=>{a+=`<li>${e}</li>`}))})),a+="</ul>",throwErrorMsg(a,{timer:!1})}}).always((()=>{removeAjaxLoaders()}))})))}})();

(()=>{const e=$("#date"),a=initPickadate(e).pickadate("picker"),t=$("#load_type_id"),r=$("#load_type_shipper"),l=$("#shipper_id"),i=$("#trip_id"),o=$("#customer_name"),s=$("#origin"),d=$("[name=origin_coords]"),n=$("#destination"),p=$("[name=destination_coords]"),c=$("#mileage");if("undefined"==typeof readOnly){let g=l.length>0?l.val():null;t.select2({ajax:{url:"/loadType/selection",data:e=>({search:e.term,page:e.page||1,take:15,shipper:g})},placeholder:"Select",allowClear:!0}),i.select2({ajax:{url:"/trip/selection",data:e=>({search:e.term,page:e.page||1,take:15,shipper:g})},placeholder:"Select",allowClear:!0}).on("select2:select",(e=>{$.ajax({url:"/trip/getTrip",type:"GET",data:{id:e.params.data.id},success:e=>{s.val(e.trip_origin?e.trip_origin.name:""),d.val(e.trip_origin?e.trip_origin.coords:"").trigger("change"),n.val(e.trip_destination?e.trip_destination.name:""),p.val(e.trip_destination?e.trip_destination.coords:"").trigger("change"),o.val(e.customer_name),c.val(e.mileage)},error:()=>{throwErrorMsg()}})})),l.length>0&&(l.select2({ajax:{url:"/shipper/selection",data:e=>({search:e.term,page:e.page||1,take:15})},placeholder:"Select",allowClear:!0}).on("select2:select",(e=>{g=e.params.data.id,r.val(g),t.prop("disabled",!1).trigger("change"),i.prop("disabled",!1).trigger("change")})).on("select2:unselect",(()=>{r.val(""),t.val("").prop("disabled",!0).trigger("change"),i.val("").prop("disabled",!0).trigger("change")})),t.val()||t.prop("disabled",!0).trigger("change")),a.set("select",e.val(),{format:"yyyy/mm/dd"}),$("#deleteLoadType").on("show.bs.modal",(e=>{let a=$("#load_type_id").html(),t=$("#delete_type");deleteHandler(t,a)})),l.length>0&&!l.val()&&i.prop("disabled",!0).trigger("change");const h=$("#createLoadModal");h.length>0&&(h.on("hidden.modal.bs",(()=>{h.find("input, select, textarea").val("").trigger("change"),h.find("#shipper_id").trigger("select2:unselect")})),$("#loadForm").submit((e=>{e.preventDefault();const a=$(e.currentTarget),t=new FormData(a[0]),r=a.attr("action");$.ajax({url:r,type:"POST",data:t,contentType:!1,processData:!1,success:e=>{e.success?("finished"===t.get("notes")?tbLoadActive.updateSearchQuery():tbLoadFinished.updateSearchQuery(),h.modal("hide")):throwErrorMsg()},error:e=>{let a='<ul class="text-left">';Object.values(e.responseJSON.errors).forEach((e=>{e.forEach((e=>{a+=`<li>${e}</li>`}))})),a+="</ul>",throwErrorMsg(a,{timer:!1})}}).always((()=>{removeAjaxLoaders()}))})))}})();

(()=>{const e=$("#requestDetails");let a=null;function t(){}function i(){}t.prototype.init=e=>{this.eGui=document.createElement("div"),this.eGui.innerHTML=`<i class="far fa-check-circle ${e.value}"></i>`},t.prototype.getGui=()=>this.eGui,i.prototype.init=t=>{this.eGui=document.createElement("div"),this.eGui.innerHTML=`<button class="btn btn-success submit-ajax" id="loadRequest-${t.value}">Accept</button>`,$((function(){$(`#loadRequest-${t.value}`).click((i=>{const r=$(i.currentTarget);r.html('<span class="spinner-border spinner-border-sm ajax-loader" role="status" aria-hidden="true"></span>'),setTimeout((()=>{r.prop("disabled",!0)}),3),$.ajax({url:"/load/road/acceptRequest",type:"POST",data:{road_load_id:a.road_load_id,request_id:t.value},success:t=>{t.success?(tbAG.updateSearchQuery(),e.modal("hide"),a=null,throwErrorMsg("The request has been accepted",{title:"Success!",type:"success"})):throwErrorMsg()},error:()=>{throwErrorMsg()}}).always((()=>{r.html("Accept"),r.prop("disabled",!1)}))}))}))},i.prototype.getGui=()=>this.eGui;const r=e=>isNaN(e)?e:numeral(e).format("$0,0.00"),d=new simpleTableAG({id:"requestsTable",columns:[{headerName:"Carrier",field:"carrier"},{headerName:"Truck",field:"truck"},{headerName:"Accept Request",field:"id",cellRenderer:i}],rowData:[],gridOptions:{components:{tableRef:"requestsTable"}},autoHeight:!0});tbAG=new tableAG({columns:[{headerTooltip:"Age",headerName:"Age",field:"age"},{headerTooltip:"Deadhead Miles",headerName:"D/H Miles",field:"deadhead_miles",filter:!1,sortable:!1},{headerTooltip:"Trip Miles",headerName:"Trip Miles",field:"mileage"},{headerTooltip:"Origin",headerName:"Origin",field:"origin_city"},{headerTooltip:"State",headerName:"ST",field:"origin_state"},{headerTooltip:"Destination",headerName:"Destination",field:"destination_city"},{headerTooltip:"State",headerName:"ST",field:"destination_state"},{headerTooltip:"Trailer Type",headerName:"Trailer Type",field:"trailer_type"},{headerTooltip:"Load Size",headerName:"Load Size",field:"load_size"},{headerTooltip:"Length",headerName:"Length",field:"length"},{headerTooltip:"Weight",headerName:"Weight",field:"weight"},{headerTooltip:"Payrate",headerName:"Payrate",field:"pay_rate"},{headerTooltip:"Estimated Rate per Mile",headerName:"Est. Rate per Mile",field:"rate_mile",filter:!1,sortable:!1},{headerTooltip:"Ship Date",headerName:"Ship Date",field:"date"},{headerTooltip:"Quick Pay",headerName:"Quick Pay",field:"quick_pay",cellRenderer:t,filter:!1,sortable:!1},{headerTooltip:"Company",headerName:"Company",field:"shipper"}],gridOptions:{undoRedoCellEditing:!0,onRowClicked:t=>{dispatch&&(e.modal("show"),tbAG.gridOptions.api.deselectAll(),a&&a.road_load_id===t.data.road_load_id?(e.find(".modal-spinner").addClass("d-none"),e.find(".content-body").removeClass("d-none")):(a=t.data,$.ajax({url:"/load/road/getRequests",type:"GET",data:{road_load_id:a.road_load_id},success:a=>{const t=[];a.forEach((e=>{t.push({id:e.id,carrier:e.carrier.name,truck:e.truck.number})})),d.rowData=t,d.gridOptions.api.setRowData(t),e.find(".modal-spinner").addClass("d-none"),e.find(".content-body").removeClass("d-none")},error:()=>{throwErrorMsg()}})))}},container:"myGrid",url:"/load/road/search",tableRef:"tbAG",searchQueryParams:{dispatch:!0},formatDSResult:e=>{const a=[];return e.rows.forEach((e=>{let t;var i;t=e.shipper.factoring?"text-success":Number(e.shipper.days_to_pay)<=15?"text-warning":"text-danger",a.push({status:e.road.request?e.road.request.status:null,road_load_id:e.road.id,age:e.age,deadhead_miles:e.road.deadhead_miles,mileage:e.mileage,origin_city:e.road.origin_city?e.road.origin_city.name:null,origin_state:e.road.origin_city?e.road.origin_city.state.abbreviation:null,destination_city:e.road.destination_city?e.road.destination_city.name:null,destination_state:e.road.destination_city?e.road.destination_city.state.abbreviation:null,trailer_type:e.road.trailer_type.name,load_size:(i=e.road.load_size,i?i.charAt(0).toUpperCase()+i.slice(1):""),length:e.road.length,weight:e.weight,pay_rate:e.road.pay_rate,rate_mile:r(e.rate_mile),date:e.date,shipper:e.shipper.name,quick_pay:t,shipper_phone:e.shipper?e.shipper.phone:null})})),{rows:a,lastRow:e.lastRow}}}),e.on("hidden.bs.modal",(()=>{e.find(".modal-spinner").removeClass("d-none"),e.find(".content-body").addClass("d-none")}))})();

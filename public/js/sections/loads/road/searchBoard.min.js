(()=>{const e=$("#origin_city"),a=$("#origin_radius"),t=$("#destination_city"),i=$("#destination_radius"),r=$("#trailer_type"),d=$("#load_size"),o=$("#ship_date"),l=$("#weight"),s=$("#length"),n=$("#loadDetails");function c(){}function h(){}c.prototype.init=e=>{let a;switch(this.eGui=document.createElement("div"),e.value){default:a="bg-light";break;case"requested":a="bg-warning";break;case"accepted":a="bg-success";break;case"rejected":a="bg-danger"}this.eGui.innerHTML=`<div class="text-center ${a} colors-container" style="width: 4px;">&nbsp;</div>`},c.prototype.getGui=()=>this.eGui,h.prototype.init=e=>{this.eGui=document.createElement("div"),this.eGui.innerHTML=`<i class="far fa-check-circle ${e.value}"></i>`},h.prototype.getGui=()=>this.eGui;const p=e=>isNaN(e)?e:numeral(e).format("$0,0.00");let _=null;const g=new simpleTableAG({id:"dataTable",columns:[{headerName:"",field:"status",filter:!1,sortable:!1,maxWidth:14,cellRenderer:c},{headerTooltip:"Age",headerName:"Age",field:"age"},{headerTooltip:"Deadhead Miles",headerName:"D/H Miles",field:"deadhead_miles"},{headerTooltip:"Trip Miles",headerName:"Trip Miles",field:"mileage"},{headerTooltip:"Origin",headerName:"Origin",field:"origin_city"},{headerTooltip:"State",headerName:"ST",field:"origin_state"},{headerTooltip:"Destination",headerName:"Destination",field:"destination_city"},{headerTooltip:"State",headerName:"ST",field:"destination_state"},{headerTooltip:"Trailer Type",headerName:"Trailer Type",field:"trailer_type"},{headerTooltip:"Load Size",headerName:"Load Size",field:"load_size"},{headerTooltip:"Length",headerName:"Length",field:"length"},{headerTooltip:"Weight",headerName:"Weight",field:"weight"},{headerTooltip:"Payrate",headerName:"Payrate",field:"pay_rate"},{headerTooltip:"Estimated Rate per Mile",headerName:"Est. Rate per Mile",field:"rate_mile"},{headerTooltip:"Ship Date",headerName:"Ship Date",field:"date"},{headerTooltip:"Quick Pay",headerName:"Quick Pay",field:"quick_pay",cellRenderer:h},{headerTooltip:"Company",headerName:"Company",field:"shipper"}],rowData:[],gridOptions:{components:{tableRef:"dataTable"},tooltipShowDelay:500,onRowClicked:e=>{n.modal("show"),_=e.data,_.origin_city&&$("#route_string").text(`${_.origin_city}, ${_.origin_state} Â» ${_.destination_city}, ${_.destination_state}`),$("#load_details_age").text(_.age),$("#load_details_mileage").text(_.mileage),$("#load_details_trailer").text(_.trailer_type),$("#load_details_size").text(_.load_size),$("#load_details_length").text(_.length),$("#load_details_weight").text(_.weight),$("#load_details_width").text(_.width),$("#load_details_height").text(_.height),$("#load_details_payrate").text(_.pay_rate),$("#load_details_date").text(_.date),$("#shipper_name").text(_.shipper),$("#shipper_phone").text(_.shipper_phone),n.find(".modal-spinner").addClass("d-none"),n.find(".content-body").removeClass("d-none"),g.gridOptions.api.deselectAll()}},autoHeight:!0});n.on("hidden.bs.modal",(()=>{n.find(".modal-spinner").removeClass("d-none"),n.find(".content-body").addClass("d-none"),_=null}));const u=(n=!1)=>{$.ajax({url:"/load/road/search",type:"GET",data:{first:n,origin_city:e.val(),origin_coords:y,origin_radius:a.val(),destination_city:t.val(),destination_coords:f,destination_radius:i.val(),trailer_type:r.val(),load_size:d.val(),ship_date_start:o.data().daterangepicker.startDate.format("YYYY/MM/DD"),ship_date_end:o.data().daterangepicker.endDate.format("YYYY/MM/DD"),weight:l.val(),length:s.val()},success:e=>{let a=[];e.forEach((e=>{let t;var i;t=e.shipper.factoring?"text-success":Number(e.shipper.days_to_pay)<=15?"text-warning":"text-danger",a.push({status:e.road.request?e.road.request.status:null,road_load_id:e.road.id,age:e.age,deadhead_miles:e.road.deadhead_miles,mileage:e.mileage,origin_city:e.road.origin_city?e.road.origin_city.name:null,origin_state:e.road.origin_city?e.road.origin_city.state.abbreviation:null,destination_city:e.road.destination_city?e.road.destination_city.name:null,destination_state:e.road.destination_city?e.road.destination_city.state.abbreviation:null,trailer_type:e.road.trailer_type.name,load_size:(i=e.road.load_size,i?i.charAt(0).toUpperCase()+i.slice(1):""),length:e.road.length,weight:e.weight,pay_rate:e.road.pay_rate,rate_mile:p(e.rate_mile),date:e.date,shipper:e.shipper.name,quick_pay:t,shipper_phone:e.shipper?e.shipper.phone:null})})),g.rowData=a,g.gridOptions.api.setRowData(a)},error:()=>{throwErrorMsg()}})},m=e=>{const a=e.params.data.locations;if(1===a.length)return{id:e.params.data.id,latitude:a[0].latitude,longitude:a[0].longitude};let t=0,i=0;return a.forEach((e=>{t+=Number(e.latitude),i+=Number(e.longitude)})),t/=a.length,i/=a.length,{id:e.params.data.id,latitude:t,longitude:i}};let y=[];e.select2({ajax:{url:"/city/selection",data:e=>({search:e.term,page:e.page||1,take:15})}}).on("select2:select",(e=>{y.push(m(e)),u()})).on("select2:unselect",(e=>{const a=y.findIndex((a=>a.id===Number(e.params.data.id)));y.splice(a,1),u()}));let f=[];t.select2({ajax:{url:"/city/selection",data:e=>({search:e.term,page:e.page||1,take:15})}}).on("select2:select",(e=>{f.push(m(e)),u()})).on("select2:unselect",(()=>{const e=f.findIndex((e=>e.id===Number(res.params.data.id)));f.splice(e,1),u()})),r.select2().on("select2:select",(()=>{u()})).on("select2:unselect",(()=>{u()})),a.change((()=>{u()})),i.change((()=>{u()})),d.change((()=>{u()})),l.change((()=>{u()})),s.change((()=>{u()})),o.daterangepicker({format:"YYYY/MM/DD"},((e,a,t)=>{u()})),u(!0);const w=$("#requestTruck");w.select2({ajax:{url:"/truck/selection",data:e=>({search:e.term,page:e.page||1,take:15,type:"hasCarrier"})},placeholder:"Select",allowClear:!0});$("#requestLoad").click((()=>{const e=w.val();e?$.ajax({url:"/load/road/request",type:"POST",data:{road_load_id:_.road_load_id,truck_id:e},success:e=>{if(e.success){removeAjaxLoaders(),n.modal("hide"),throwErrorMsg("Your request has been sent successfully",{title:"Success!",type:"success"});const e=g.rowData.find((e=>e.road_load_id===_.road_load_id));-1!==e&&(g.rowData[e].status="requested",g.gridOptions.api.setRowData(g.rowData)),n.modal("hide")}else throwErrorMsg()},error:()=>{throwErrorMsg()}}).always((()=>{removeAjaxLoaders()})):throwErrorMsg("Select the truck you want to assign to this load to continue")}))})();

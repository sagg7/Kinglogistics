(()=>{const e=$("#origin_city"),a=$("#origin_radius"),t=$("#destination_city"),i=$("#destination_radius"),d=$("#trailer_type"),r=$("#load_size"),l=$("#ship_date"),o=$("#weight"),n=$("#length"),s=$("#loadDetails"),h=e=>isNaN(e)?e:numeral(e).format("$0,0.00"),p=new simpleTableAG({id:"dataTable",columns:[{headerTooltip:"Age",headerName:"Age",field:"age"},{headerTooltip:"Deadhead Miles",headerName:"D/H Miles",field:"deadhead_miles"},{headerTooltip:"Trip Miles",headerName:"Trip Miles",field:"mileage"},{headerTooltip:"Origin",headerName:"Origin",field:"origin_city"},{headerTooltip:"State",headerName:"ST",field:"origin_state"},{headerTooltip:"Destination",headerName:"Destination",field:"destination_city"},{headerTooltip:"State",headerName:"ST",field:"destination_state"},{headerTooltip:"Trailer Type",headerName:"Trailer Type",field:"trailer_type"},{headerTooltip:"Load Size",headerName:"Load Size",field:"load_size"},{headerTooltip:"Length",headerName:"Length",field:"length"},{headerTooltip:"Weight",headerName:"Weight",field:"weight"},{headerTooltip:"Payrate",headerName:"Payrate",field:"pay_rate"},{headerTooltip:"Estimated Rate per Mile",headerName:"Est. Rate per Mile",field:"rate_mile"},{headerTooltip:"Ship Date",headerName:"Ship Date",field:"date"},{headerTooltip:"Quick Pay",headerName:"Quick Pay",field:"quick_pay"},{headerTooltip:"Company",headerName:"Company",field:"shipper"}],rowData:[],gridOptions:{components:{tableRef:"dataTable"},tooltipShowDelay:500,onRowClicked:e=>{const a=e.data;a.origin_city&&$("#route_string").text(`${a.origin_city}, ${a.origin_state} Â» ${a.destination_city}, ${a.destination_state}`),$("#load_details_age").text(a.age),$("#load_details_mileage").text(a.mileage),$("#load_details_trailer").text(a.trailer_type),$("#load_details_size").text(a.load_size),$("#load_details_length").text(a.length),$("#load_details_weight").text(a.weight),$("#load_details_width").text(a.width),$("#load_details_height").text(a.height),$("#load_details_payrate").text(a.pay_rate),$("#load_details_date").text(a.date),$("#shipper_name").text(a.shipper),$("#shipper_phone").text(a.shipper_phone),s.find(".modal-spinner").addClass("d-none"),s.find(".content-body").removeClass("d-none"),s.modal("show"),p.gridOptions.api.deselectAll()}},autoHeight:!0}),_=(s=!1)=>{$.ajax({url:"/load/road/search",type:"GET",data:{first:s,origin_city:e.val(),origin_coords:c,origin_radius:a.val(),destination_city:t.val(),destination_coords:m,destination_radius:i.val(),trailer_type:d.val(),load_size:r.val(),ship_date_start:l.data().daterangepicker.startDate.format("YYYY/MM/DD"),ship_date_end:l.data().daterangepicker.endDate.format("YYYY/MM/DD"),weight:o.val(),length:n.val()},success:e=>{let a=[];e.forEach((e=>{var t;a.push({age:e.age,deadhead_miles:e.road.deadhead_miles,mileage:e.mileage,origin_city:e.road.origin_city?e.road.origin_city.name:null,origin_state:e.road.origin_city?e.road.origin_city.state.abbreviation:null,destination_city:e.road.destination_city?e.road.destination_city.name:null,destination_state:e.road.destination_city?e.road.destination_city.state.abbreviation:null,trailer_type:e.road.trailer_type.name,load_size:(t=e.road.load_size,t?t.charAt(0).toUpperCase()+t.slice(1):""),length:e.road.length,weight:e.weight,pay_rate:e.road.pay_rate,rate_mile:h(e.rate_mile),date:e.date,shipper:e.shipper.name,quick_pay:null,shipper_phone:e.shipper?e.shipper.phone:null})})),p.rowData=a,p.gridOptions.api.setRowData(a)},error:()=>{throwErrorMsg()}})},g=e=>{const a=e.params.data.locations;if(1===a.length)return{id:e.params.data.id,latitude:a[0].latitude,longitude:a[0].longitude};let t=0,i=0;return a.forEach((e=>{t+=Number(e.latitude),i+=Number(e.longitude)})),t/=a.length,i/=a.length,{id:e.params.data.id,latitude:t,longitude:i}};let c=[];e.select2({ajax:{url:"/city/selection",data:e=>({search:e.term,page:e.page||1,take:15})}}).on("select2:select",(e=>{c.push(g(e)),_()})).on("select2:unselect",(e=>{const a=c.findIndex((a=>a.id===Number(e.params.data.id)));c.splice(a,1),_()}));let m=[];t.select2({ajax:{url:"/city/selection",data:e=>({search:e.term,page:e.page||1,take:15})}}).on("select2:select",(e=>{m.push(g(e)),_()})).on("select2:unselect",(()=>{const e=m.findIndex((e=>e.id===Number(res.params.data.id)));m.splice(e,1),_()})),d.select2().on("select2:select",(()=>{_()})).on("select2:unselect",(()=>{_()})),a.change((()=>{_()})),i.change((()=>{_()})),r.change((()=>{_()})),o.change((()=>{_()})),n.change((()=>{_()})),l.daterangepicker({format:"YYYY/MM/DD"},((e,a,t)=>{_()})),_(!0)})();

(()=>{let e={current:{},next:{}};const t=$("#dispatch"),s=$("input[type=checkbox]");let r=!1,c=null;const a=()=>{r&&(r=!1,c.prop("checked",!1),c=null)};t.select2({placeholder:"Select",ajax:{url:"/user/selection",data:e=>({search:e.term,page:e.page||1,take:15,type:"dispatch"})},allowClear:!0}).on("select2:select",(()=>{a()})).on("select2:unselect",(()=>{a()}));const n=e=>e.attr("id").split("_")[0],l=e=>Number(e.attr("id").split("_")[1]),o=e=>(console.log(e.attr("id").split("_")),e.attr("id").split("_")[2]);s.click((s=>{const a=$(s.currentTarget),u=o(a);let d="";if(null===t.val()&&a.is(":checked")&&(d="A dispatcher must be selected to continue"),""!==d&&c&&u!==o(c)&&(d="Select a range within the same table to continue"),""!==d)return throwErrorMsg(d),s.preventDefault(),!1;if(r){const s=n(c);if(s!==n(a))return throwErrorMsg("Select the second time on the same day column"),!1;const o=l(a),d=l(c);let i,p;o>d?(i=d,p=o):(i=o,p=d);for(let r=i;r<=p;r++){const c=$(`#${s}_${r}_${u}`),a=c.prev();c.prop("checked",!0).val(t.val()),a.text(t.find("option:selected").text()),e[u][`${s}_${r}`]={user:t.val(),day:s,hour:r}}c.prev().removeClass("box-shadow-1"),r=!1,c=null}else if(a.is(":checked"))r=!0,c=a,a.prop("checked",!0).prev().text(t.find("option:selected").text()),a.prev().addClass("box-shadow-1");else{r=!1,a.prev().text("");const t=a.attr("id").split("_");delete e[u][`${t[0]}_${t[1]}`]}}));const u=$("#current-week-schedule"),d=$("#next-week-schedule");$("#week").select2().on("select2:select",(e=>{switch(e.params.data.id){default:case"current":u.removeClass("d-none"),d.addClass("d-none");break;case"next":u.addClass("d-none"),d.removeClass("d-none")}}));schedule.forEach((t=>{const s=(e=>{switch(e){default:case 0:return"mon";case 1:return"tue";case 2:return"wed";case 3:return"thu";case 4:return"fri";case 5:return"sat";case 6:return"sun"}})(t.day),r=$(`#${s}_${t.time_number}_${t.status}`);e[t.status][`${s}_${t.time_number}`]={user:t.user_id,day:s,hour:t.time_number},r.prop("checked",!0).val(t.user_id).prev().text(t.user.name)}));const i=$("#scheduleForm");i.submit((t=>{t.preventDefault(),$.ajax({url:i.attr("action"),type:"POST",data:e,success:e=>{e.success?window.location="/user/index":throwErrorMsg()},error:()=>{throwErrorMsg()}})}))})();

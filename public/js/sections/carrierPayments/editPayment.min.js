(()=>{let e=[];const a=$("#subtotal"),t=$("#reductions"),n=$("#total");let r=Number(a.val()),s=Number(t.val()),i=Number(n.val());const o=e=>{const o=Number(e.amount);switch(e.type){case"reduce":if(i-o<0)return!1;s+=o,i-=o;break;case"add":r+=o,i+=o}return a.val(d(r)),t.val(d(s)),n.val(d(i)),!0},d=e=>numeral(e).format("$0,0.00"),u=e=>e.value?numeral(e.value).format("$0,0.00"):"$0.00",l=e=>e.value?e.value.charAt(0).toUpperCase()+e.value.slice(1):"",m=()=>{if(_aggrid)return _aggrid.rowData=e,_aggrid.gridOptions.api.setRowData(e),_aggrid.grid.gridOptions.api.setPinnedBottomRowData(_aggrid.pinnedBottomFunction(_aggrid)),void _aggrid.gridOptions.api.sizeColumnsToFit();_aggrid=new simpleTableAG({id:"paymentData",columns:[{headerName:"Date",field:"date"},{headerName:"Type",field:"type",valueFormatter:l},{headerName:"Description",field:"description"},{headerName:"Amount",field:"amount",valueFormatter:u},{headerName:"",field:"remove",cellRenderer:"RemoveBtnRenderer",width:70,maxWidth:70,minWidth:70,cellStyle:{padding:0}}],gridOptions:{components:{RemoveBtnRenderer,tableRef:"_aggrid"}},autoHeight:!0,rowData:e,onRemoveRow:e=>{let a={},t=null;switch(e.type){case"expense":t=expenses.findIndex((a=>a.id===e.id)),a=expenses[t],isNaN(Number(e.id))&&expenses.splice(t,1),o({type:"add",amount:a.amount});break;case"bonus":t=bonuses.findIndex((a=>a.id===e.id)),a=bonuses[t],isNaN(Number(e.id))&&bonuses.splice(t,1),o({type:"reduce",amount:a.amount});break;default:return}a.delete=1}}),setTimeout((()=>{_aggrid.gridOptions.api.sizeColumnsToFit()}),300)};bonuses.forEach((a=>{e.push({id:a.id,type:"bonus",amount:a.amount,date:a.date,description:a.description})})),expenses.forEach((a=>{e.push({id:a.id,type:"expense",amount:a.amount,date:a.date?a.date:a.created_at,description:a.description})})),m(),a.val(d(a.val())),t.val(d(t.val())),n.val(d(n.val()));const p=$("#type"),c=$("[name=date_submit]"),g=$("#description"),v=$("#amount");p.select2({placeholder:"Select"}),$("#addElement").click((()=>{const a=p.val();let t={id:`new_${Math.random().toString(36).substring(3,8)}`,amount:v.val(),date:c.val(),description:g.val()};switch(e.push(_.merge(t,{type:a})),m(),a){case"bonus":bonuses.push(t),o({type:"add",amount:t.amount});break;case"expense":expenses.push(t),o({type:"reduce",amount:t.amount})}v.val(""),g.val(""),p.val("").trigger("change")})),$("#updatePayment").submit((e=>{e.preventDefault();const a=$(e.currentTarget).attr("action");$.ajax({url:a,type:"POST",data:{bonuses,expenses,subtotal:r,reductions:s,total:i},success:e=>{e.success?window.location="/carrier/payment":throwErrorMsg()},error:()=>{throwErrorMsg()}})}))})();

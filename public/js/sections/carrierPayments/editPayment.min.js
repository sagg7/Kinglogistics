(()=>{let e=[];const t=$("#subtotal"),a=$("#reductions"),n=$("#total");let r=Number(t.val()),o=Number(a.val()),s=Number(n.val());const i=e=>{console.log(e);const i=Number(e.amount);switch(e.type){case"remove":case"reduce":if(s-i<0)return throwErrorMsg("The total quantity must be bigger than $0"),!1;"increase"===e.type?o+=i:(console.log(r),r-=i,console.log(r)),s-=i;break;case"increase":case"add":"increase"===e.type?o-=i:r+=i,s+=i}return t.val(d(r)),a.val(d(o)),n.val(d(s)),!0},d=e=>numeral(e).format("$0,0.00"),u=e=>e.value?numeral(e.value).format("$0,0.00"):"$0.00",l=e=>e.value?e.value.charAt(0).toUpperCase()+e.value.slice(1):"",c=()=>{if(_aggrid)return _aggrid.rowData=e,_aggrid.gridOptions.api.setRowData(e),_aggrid.grid.gridOptions.api.setPinnedBottomRowData(_aggrid.pinnedBottomFunction(_aggrid)),void _aggrid.gridOptions.api.sizeColumnsToFit();_aggrid=new simpleTableAG({id:"paymentData",columns:[{headerName:"Date",field:"date"},{headerName:"Type",field:"type",valueFormatter:l},{headerName:"Description",field:"description"},{headerName:"Amount",field:"amount",valueFormatter:u},{headerName:"",field:"remove",cellRenderer:"RemoveBtnRenderer",width:70,maxWidth:70,minWidth:70,cellStyle:{padding:0}}],gridOptions:{components:{RemoveBtnRenderer,tableRef:"_aggrid"}},autoHeight:!0,rowData:e,removeValidation:e=>{switch(console.log(e,"here too"),e.type){case"bonus":const t=bonuses.find((t=>t.id===e.id));if(s-t.amount<0)return throwErrorMsg("The total quantity must be bigger than $0"),!1}return!0},onRemoveRow:e=>{let t={},a=null;switch(e.type){case"expense":a=expenses.findIndex((t=>t.id===e.id)),t=expenses[a],isNaN(Number(e.id))&&expenses.splice(a,1),i({type:"increase",amount:t.amount});break;case"bonus":if(a=bonuses.findIndex((t=>t.id===e.id)),t=bonuses[a],!i({type:"remove",amount:t.amount}))return!1;isNaN(Number(e.id))&&bonuses.splice(a,1);break;default:return}t.delete=1}}),setTimeout((()=>{_aggrid.gridOptions.api.sizeColumnsToFit()}),300)};bonuses.forEach((t=>{e.push({id:t.id,type:"bonus",amount:t.amount,date:t.date,description:t.description})})),expenses.forEach((t=>{e.push({id:t.id,type:"expense",amount:t.amount,date:t.date?t.date:t.created_at,description:t.description})})),c(),t.val(d(t.val())),a.val(d(a.val())),n.val(d(n.val()));const m=$("#type"),p=$("[name=date_submit]"),g=$("#description"),v=$("#amount");m.select2({placeholder:"Select"}),$("#addElement").click((()=>{const t=m.val();let a={id:`new_${Math.random().toString(36).substring(3,8)}`,amount:v.val(),date:p.val(),description:g.val()};switch(t){case"bonus":bonuses.push(a),i({type:"add",amount:a.amount});break;case"expense":if(!i({type:"reduce",amount:a.amount}))return!1;expenses.push(a)}e.push(_.merge(a,{type:t})),c(),v.val(""),g.val(""),m.val("").trigger("change")})),$("#updatePayment").submit((e=>{e.preventDefault();const t=$(e.currentTarget).attr("action");$.ajax({url:t,type:"POST",data:{bonuses,expenses,subtotal:r,reductions:o,total:s},success:e=>{e.success?window.location="/carrier/payment":throwErrorMsg()},error:()=>{throwErrorMsg()}})}))})();

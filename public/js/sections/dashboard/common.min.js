(()=>{const e=$("[name=shipper]"),t=$("[name=trips]"),a=$("[name=driver]");let r=null,n=null,o=null;const s=[],i=$("#loads-summary").find("table"),d=()=>{i.find("h2").text(0),$.ajax({url:"/dashboard/getData",type:"GET",data:{shipper:r,trip:n,driver:o},success:e=>{e.loads&&Object.entries(e.loads).forEach((e=>{const[t,a]=e;$(`#${t}_summary`).text(a.count),s.push({status:t,count:a.count,data:a.data})}))},error:()=>{throwErrorMsg()}})},l=e=>{if(e.data)return e.data.roles[0].name},c=e=>e.value?`${e.value}%`:"";function h(){}function u(){}h.prototype.init=e=>{this.eGui=document.createElement("div"),e.value&&(this.eGui.innerHTML=`<a href="tel:${e.value}">${e.value}</a>`)},h.prototype.getGui=()=>this.eGui,u.prototype.init=e=>{this.eGui=document.createElement("div"),e.value&&(this.eGui.innerHTML=`<a href="mailto:${e.value}">${e.value}</a>`)},u.prototype.getGui=()=>this.eGui;const p=e=>e.value?e.value.charAt(0).toUpperCase()+e.value.slice(1)+`${e.data.status_current} of ${e.data.status_total}`:"",m=e=>e.value?`${e.value} min`:"";"undefined"!=typeof tbOnCall&&(tbOnCall=new simpleTableAG({id:"onCallTable",columns:[{headerName:"Name",field:"name"},{headerName:"Role",field:"role",valueFormatter:l},{headerName:"Email",field:"email",cellRenderer:u},{headerName:"Phone",field:"phone",cellRenderer:h}],rowData:[],gridOptions:{components:{tableRef:"tbOnCall"}}}),$.ajax({type:"GET",url:"/user/searchActive",data:{all:!0},success:e=>{tbOnCall.rowData=e,tbOnCall.gridOptions.api.setRowData(e),tbOnCall.gridOptions.api.sizeColumnsToFit()},error:()=>{throwErrorMsg()}})),"undefined"!=typeof tbJobs&&(tbJobs=new simpleTableAG({id:"jobsTable",columns:[{headerName:"Name",field:"name"},{headerName:"Status",field:"status",valueFormatter:p},{headerName:"Percentage",field:"percentage",valueFormatter:c},{headerName:"Miles",field:"mileage"},{headerName:"AVG",field:"avg",valueFormatter:m}],rowData:[],gridOptions:{components:{tableRef:"tbJobs"}}}),$.ajax({type:"GET",url:"/trip/dashboardData",success:e=>{tbJobs.rowData=e,tbJobs.gridOptions.api.setRowData(e),tbJobs.gridOptions.api.sizeColumnsToFit()},error:()=>{throwErrorMsg()}}));const b=(e,t,a)=>{const r={chart:{height:350,type:"bar"},plotOptions:{bar:{horizontal:!1,endingShape:"flat",columnWidth:"55%"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},series:t,legend:{offsetY:-10},xaxis:{categories:[""]},fill:{opacity:1},tooltip:{y:{formatter:function(e){return Number(e)}}}};_.merge(r,a);const n=new ApexCharts(document.querySelector(`#${e}`),r);return n.render(),n};let g=null;const v=()=>{$.ajax({url:"/driver/search",type:"GET",data:{graph:!0,shipper:r,trip:n,driver:o},success:e=>{const t=[{name:"Active",data:[e.morning.active,e.night.active]},{name:"Inactive",data:[e.morning.inactive,e.night.inactive]},{name:"Ready",data:[e.morning.ready,e.night.ready]},{name:"Pending",data:[e.morning.pending,e.night.pending]},{name:"Error",data:[e.morning.error,e.night.error]}];if(g)g.updateSeries(t);else{const e={colors:[chartColorsObj.primary,chartColorsObj.info,chartColorsObj.success,chartColorsObj.warning,chartColorsObj.danger]};g=((e,t,a)=>{const r={series:t,chart:{type:"bar",height:350,stacked:!0,toolbar:{show:!0},zoom:{enabled:!0}},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],plotOptions:{bar:{horizontal:!1,borderRadius:10}},xaxis:{categories:["Morning","Night"]},legend:{position:"right",offsetY:40},fill:{opacity:1}};_.merge(r,a);const n=new ApexCharts(document.querySelector(`#${e}`),r);return n.render(),n})("driversChart",t,e)}}})};let f=null;const y=()=>{$.ajax({url:"/trailer/search",type:"GET",data:{graph:!0,shipper:r,trip:n,driver:o},success:e=>{const t=[{name:"Total",data:[e.all]},{name:"In Use",data:[e.available]},{name:"Available",data:[e.rented]}],a={yaxis:{title:{text:"Number of trailers"}}};f?f.updateSeries(t):f=b("trailersChart",t,a)}})};let C=null;const w=()=>{$.ajax({url:"/truck/search",type:"GET",data:{graph:!0,shipper:r},success:e=>{const t=[{name:"Total",data:[e.all]},{name:"In Use",data:[e.in_use]},{name:"Available",data:[e.available]}],a={yaxis:{title:{text:"Number of trailers"}}};C?C.updateSeries(t):C=b("trucksChart",t,a)}})};"web"===guard&&(v(),y(),w()),e.select2({ajax:{url:"/shipper/selection",data:e=>({search:e.term,page:e.page||1,take:15})},placeholder:"Select",allowClear:!0}).on("select2:select",(e=>{r=e.params.data.id,s.length=0,d(),v(),y(),w()})).on("select2:unselect",(e=>{r=null,d(),v(),y(),w()})),t.select2({ajax:{url:"/trip/selection",data:t=>({search:t.term,page:t.page||1,take:15,shipper:e.val()})},placeholder:"Select",allowClear:!0}).on("select2:select",(e=>{n=e.params.data.id,s.length=0,d(),v(),y()})).on("select2:unselect",(e=>{n=null,d(),v(),y()})),a.select2({ajax:{url:"/driver/selection",type:"GET",data:e=>({search:e.term,page:e.page||1,take:15,shipper:r,trip:n,driver:o})},placeholder:"Select",allowClear:!0}).on("select2:select",(e=>{o=e.params.data.id,s.length=0,d(),v(),y()})).on("select2:unselect",(e=>{o=null,d(),v(),y()})),d();const x=e=>{const t=$("#viewLoadStatus"),a=t.find(".modal-title"),r=t.find(".modal-body"),n=r.find(".modal-spinner"),o=r.find(".content-body");n.removeClass("d-none"),o.addClass("d-none"),o.html('<div class="table-responsive"><table class="table table-hover" id="loadTableSummary"><thead><tr>'+("shipper"!==guard?"<th>Shipper</th>":"")+"<th>Origin</th><th>Destination</th><th>Driver</th><th>Truck#</th>"+("carrier"!==guard?"<th>Carrier</th>":"")+"</tr></thead><tbody></tbody></table></div>");const s=$("#loadTableSummary").find("tbody");var i;a.text(`${i=e.status,i.charAt(0).toUpperCase()+i.slice(1)}`);let d="";const l=[];e.data.forEach(((e,t)=>{const a=`row_${t}`;l.push(a),d+=`<tr class="cursor-pointer" id="${a}">`+("shipper"!==guard?`<td>${e.shipper.name}</td>`:"")+`<td>${e.origin}</td>`+`<td>${e.destination}</td>`+`<td>${e.driver?e.driver.name:""}</td>`+`<td>${e.truck?e.truck.number:""}</td>`+("carrier"!==guard?`<td>${e.driver?e.driver.carrier.name:""}</td></tr>`:"")})),s.html(d),l.forEach(((t,a)=>{$(`#${t}`).click((()=>{(e=>{const t=$("#viewLoad"),a=t.find(".modal-body"),r=a.find(".modal-spinner"),n=a.find(".content-body");r.removeClass("d-none"),n.addClass("d-none"),n.html('<div class="table-responsive"><table class="table"><thead><tr>'+("shipper"!==guard?"<th>Shipper</th>":"")+"<th>Driver</th><th>Truck#</th>"+("carrier"!==guard?"<th>Carrier</th>":"<th></th>")+("shipper"===guard?"<th></th>":"")+"</tr></thead><tbody><tr>"+("shipper"!==guard?`<td>${e.shipper.name}</td>`:"")+`<td>${e.driver?e.driver.name:""}</td>`+`<td>${e.truck?e.truck.number:""}</td>`+("carrier"!==guard?`<td>${e.driver?e.driver.carrier.name:""}</td>`:"<td></td>")+"</tr><tr><th>Load type</th><th>Date</th><th>Origin</th><th>Destination</th></tr><tr>"+`<td>${e.load_type?e.load_type.name:""}</td>`+`<td>${e.date?e.date:""}</td>`+`<td>${e.origin?e.origin:""}</td>`+`<td>${e.destination?e.destination:""}</td></tr><tr><th>Control#</th><th>Customer name</th><th>Customer po</th><th>Customer reference</th></tr><tr>`+`<td>${e.control_number?e.control_number:""}</td>`+`<td>${e.customer_name?e.customer_name:""}</td>`+`<td>${e.customer_po?e.customer_po:""}</td>`+`<td>${e.customer_reference?e.customer_reference:""}</td></tr><tr><th>Weight</th><th>Tons</th><th>Silo number</th><th>Mileage</th></tr><tr>`+`<td>${e.weight?e.weight:""}</td>`+`<td>${e.tons?e.tons:""}</td>`+`<td>${e.silo_number?e.silo_number:""}</td>`+`<td>${e.mileage?e.mileage:""}</td></tr></tbody></table></div>`),r.addClass("d-none"),n.removeClass("d-none"),t.modal("show")})(e.data[a])}))})),n.addClass("d-none"),o.removeClass("d-none"),t.modal("show")};$('[id*="_summary"]').click((e=>{e.preventDefault(),e.stopPropagation();const t=$(e.currentTarget).attr("id").split("_summary")[0],a=s.find((e=>e.status===t));a&&x(a)})),void 0!==window.Echo&&window.Echo.private("load-status-update").listen("LoadUpdate",(e=>{const t=e.load,a=t.status;let r=null,n=null;if(s.forEach(((e,a)=>{const o=e.data.findIndex((e=>Number(e.id)===Number(t.id)));if(-1!==o)return n=o,r=a,!1})),null!==n){const e=s[r],t=e.status;if(t===a)return!1;e.data.splice(n,1),e.count=e.data.length,$(`#${t}_summary`).text(e.count)}const o=$(`#${a}_summary`),i=s.find((e=>e.status===a));o.text(Number(o.text())+1),i?i.data.push(t):s.push({status:a,count:1,data:[t]})}))})();

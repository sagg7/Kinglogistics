(()=>{const e=$("[name=shipper]"),t=$("[name=trips]"),a=$("[name=driver]");let r=null,s=null,l=null;const o=[],n=$("#loads-summary").find("table"),i=()=>{n.find("h2").text(0),$.ajax({url:"/dashboard/getData",type:"GET",data:{shipper:r,trip:s,driver:l},success:e=>{e.loads&&Object.entries(e.loads).forEach((e=>{const[t,a]=e;$(`#${t}_summary`).text(a.count),o.push({status:t,count:a.count,data:a.data})}))},error:()=>{throwErrorMsg()}})},d=e=>{if(e.data)return e.data.roles[0].name},u=e=>e.value?`${e.value.toFixed(2)}%`:"";function c(){}function p(){}c.prototype.init=e=>{this.eGui=document.createElement("div"),e.value&&(this.eGui.innerHTML=`<a href="tel:${e.value}">${e.value}</a>`)},c.prototype.getGui=()=>this.eGui,p.prototype.init=e=>{this.eGui=document.createElement("div"),e.value&&(this.eGui.innerHTML=`<a href="mailto:${e.value}">${e.value}</a>`)},p.prototype.getGui=()=>this.eGui;const h=e=>e.value?e.value.charAt(0).toUpperCase()+e.value.slice(1)+`${e.data.status_current} of ${e.data.status_total}`:"",m=e=>e.value?`${e.value.toFixed(2)} min`:"";"undefined"!=typeof tbOnCall&&(tbOnCall=new simpleTableAG({id:"onCallTable",columns:[{headerName:"Name",field:"name"},{headerName:"Role",field:"role",valueFormatter:d},{headerName:"Email",field:"email",cellRenderer:p},{headerName:"Phone",field:"phone",cellRenderer:c}],rowData:[],gridOptions:{components:{tableRef:"tbOnCall"}}}),$.ajax({type:"GET",url:"/user/searchActive",data:{all:!0},success:e=>{tbOnCall.rowData=e,tbOnCall.gridOptions.api.setRowData(e),tbOnCall.gridOptions.api.sizeColumnsToFit()},error:()=>{throwErrorMsg()}})),"undefined"!=typeof tbJobs&&(tbJobs=new simpleTableAG({id:"jobsTable",columns:[{headerName:"Name",field:"name"},{headerName:"Status",field:"status",valueFormatter:h},{headerName:"Percentage",field:"percentage",valueFormatter:u},{headerName:"Miles",field:"mileage"},{headerName:"AVG",field:"avg",valueFormatter:m},{headerName:"Load time",field:"load_time",valueFormatter:m}],rowData:[],gridOptions:{components:{tableRef:"tbJobs"}}}),$.ajax({type:"GET",url:"/trip/dashboardData",success:e=>{tbJobs.rowData=e,tbJobs.gridOptions.api.setRowData(e),tbJobs.gridOptions.api.sizeColumnsToFit()},error:()=>{throwErrorMsg()}}));const g=(e,t,a)=>{const r={chart:{height:350,type:"bar"},plotOptions:{bar:{horizontal:!1,endingShape:"flat",columnWidth:"55%"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},series:t,legend:{offsetY:-10},xaxis:{categories:[""]},fill:{opacity:1},tooltip:{y:{formatter:function(e){return Number(e)}}}};_.merge(r,a);const s=new ApexCharts(document.querySelector(`#${e}`),r);return s.render(),s};let b=null;const f=()=>{if("web"!==guard)return!1;$.ajax({url:"/driver/search",type:"GET",data:{graph:!0,shipper:r,trip:s,driver:l},success:e=>{const t=[{name:"Active",data:[e.morning.active,e.night.active]},{name:"Inactive",data:[e.morning.inactive,e.night.inactive]},{name:"Ready",data:[e.morning.ready,e.night.ready]},{name:"Pending",data:[e.morning.pending,e.night.pending]},{name:"Error",data:[e.morning.error,e.night.error]}];if(b)b.updateSeries(t);else{const e={colors:[chartColorsObj.primary,chartColorsObj.info,chartColorsObj.success,chartColorsObj.warning,chartColorsObj.danger]};b=((e,t,a)=>{const r={series:t,chart:{type:"bar",height:350,stacked:!0,toolbar:{show:!0},zoom:{enabled:!0}},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],plotOptions:{bar:{horizontal:!1,borderRadius:10}},xaxis:{categories:["Morning","Night"]},legend:{position:"right",offsetY:40},fill:{opacity:1}};_.merge(r,a);const s=new ApexCharts(document.querySelector(`#${e}`),r);return s.render(),s})("driversChart",t,e)}}})};let v=null;const y=()=>{if("web"!==guard)return!1;$.ajax({url:"/trailer/search",type:"GET",data:{graph:!0,shipper:r,trip:s,driver:l},success:e=>{const t=[{name:"Total",data:[e.all]},{name:"In Use",data:[e.rented]},{name:"Available",data:[e.available]}],a={yaxis:{title:{text:"Number of trailers"}}};v?v.updateSeries(t):v=g("trailersChart",t,a)}})};let w=null;const x=()=>{if("web"!==guard)return!1;$.ajax({url:"/truck/search",type:"GET",data:{graph:!0,shipper:r,trip:s,driver:l},success:e=>{let t=[];e.forEach((e=>{t.push({name:e.shipper,data:[e.count]})}));const a={yaxis:{title:{text:"Number of trailers"}}};w?w.updateSeries(t):w=g("trucksChart",t,a)}})};"web"===guard&&(f(),y(),x()),e.select2({ajax:{url:"/shipper/selection",data:e=>({search:e.term,page:e.page||1,take:15})},placeholder:"Select",allowClear:!0}).on("select2:select",(e=>{r=e.params.data.id,o.length=0,i(),f(),y(),x()})).on("select2:unselect",(e=>{r=null,i(),f(),y(),x()})),t.select2({ajax:{url:"/trip/selection",data:t=>({search:t.term,page:t.page||1,take:15,shipper:e.val()})},placeholder:"Select",allowClear:!0}).on("select2:select",(e=>{s=e.params.data.id,o.length=0,i(),f(),y(),x()})).on("select2:unselect",(e=>{s=null,i(),f(),y(),x()})),a.select2({ajax:{url:"/driver/selection",type:"GET",data:e=>({search:e.term,page:e.page||1,take:15,shipper:r,trip:s,driver:l})},placeholder:"Select",allowClear:!0}).on("select2:select",(e=>{l=e.params.data.id,o.length=0,i(),f(),y(),x()})).on("select2:unselect",(e=>{l=null,i(),f(),y(),x()})),i(),$('[id*="_summary"]').click((e=>{e.preventDefault(),e.stopPropagation();const t=$(e.currentTarget).attr("id").split("_summary")[0],a=o.find((e=>e.status===t));a&&showStatusModal(a)})),void 0!==window.Echo&&window.Echo.private(`load-status-update-${guard}.${loadChannelId}`).listen("LoadUpdate",(t=>{const a=t.load;if(Number(e.val())!==Number(a.shipper.id))return!1;const r=a.status;let s=null,l=null;if(o.forEach(((e,t)=>{const r=e.data.findIndex((e=>Number(e.id)===Number(a.id)));if(-1!==r)return l=r,s=t,!1})),null!==l){const e=o[s],t=e.status;if(t===r)return!1;e.data.splice(l,1),e.count=e.data.length,$(`#${t}_summary`).text(e.count)}const n=$(`#${r}_summary`),i=o.find((e=>e.status===r));n.text(Number(n.text())+1),i?i.data.push(a):o.push({status:r,count:1,data:[a]})}))})();

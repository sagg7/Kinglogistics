(()=>{const t=$("[name=trips]");let a=null;const e=[],r=$("#loads-summary").find("table"),d=()=>{r.find("h2").text(0),$.ajax({url:"/dashboard/getData",type:"GET",data:{trip:a},success:t=>{t.loads&&Object.entries(t.loads).forEach((t=>{const[a,r]=t;$(`#${a}_summary`).text(r.count),e.push({status:a,count:r.count,data:r.data})}))},error:()=>{throwErrorMsg()}})};t.select2({ajax:{url:"/trip/selection",data:t=>({search:t.term,page:t.page||1,take:15})},placeholder:"Select",allowClear:!0}).on("select2:select",(t=>{a=t.params.data.id,e.length=0,d()})).on("select2:unselect",(t=>{a=null,d()})),d();$('[id*="_summary"]').click((t=>{t.preventDefault(),t.stopPropagation();const a=$(t.currentTarget).attr("id").split("_summary")[0],r=e.find((t=>t.status===a));r&&(t=>{const a=$("#viewLoadStatus"),e=a.find(".modal-title"),r=a.find(".modal-body"),d=r.find(".modal-spinner"),s=r.find(".content-body");d.removeClass("d-none"),s.addClass("d-none"),s.html('<div class="table-responsive"><table class="table table-hover" id="loadTableSummary"><thead><tr><th>Shipper</th><th>Origin</th><th>Destination</th><th>Driver</th><th>Truck#</th>'+("carrier"!==guard?"<th>Carrier</th>":"")+"</tr></thead><tbody></tbody></table></div>");const n=$("#loadTableSummary").find("tbody");var o;e.text(`${o=t.status,o.charAt(0).toUpperCase()+o.slice(1)}`);let l="";t.data.forEach((t=>{l+=`<tr><td>${t.shipper.name}</td><td>${t.origin}</td><td>${t.destination}</td><td>${t.driver?t.driver.name:""}</td><td>${t.truck?t.truck.number:""}</td>`+("carrier"!==guard?`<td>${t.driver?t.driver.carrier.name:""}</td></tr>`:"")})),n.html(l),d.addClass("d-none"),s.removeClass("d-none"),a.modal("show")})(r)})),void 0!==window.Echo&&window.Echo.private("load-status-update").listen("LoadUpdate",(t=>{const a=t.load,r=a.status;let d=null,s=null;if(e.forEach(((t,e)=>{const r=t.data.findIndex((t=>Number(t.id)===Number(a.id)));if(-1!==r)return s=r,d=e,!1})),null!==s){const t=e[d],a=t.status;if(a===r)return!1;t.data.splice(s,1),t.count=t.data.length,$(`#${a}_summary`).text(t.count)}const n=$(`#${r}_summary`),o=e.find((t=>t.status===r));n.text(Number(n.text())+1),o?o.data.push(a):e.push({status:r,count:1,data:[a]})}))})();

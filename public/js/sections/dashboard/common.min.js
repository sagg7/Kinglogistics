(()=>{const t=[];$.ajax({url:"/dashboard/getData",type:"GET",success:a=>{a.loads&&Object.entries(a.loads).forEach((a=>{const[r,e]=a,d=new CountUp(`${r}_summary`,e.count);d.error?console.error(d.error):d.start(),t.push({status:r,count:e.count,data:e.data})}))},error:()=>{throwErrorMsg()}});$('[id*="_summary"]').click((a=>{a.preventDefault(),a.stopPropagation();const r=$(a.currentTarget).attr("id").split("_")[0],e=t.find((t=>t.status===r));e&&(t=>{const a=$("#viewLoadStatus"),r=a.find(".modal-title"),e=a.find(".modal-body"),d=e.find(".modal-spinner"),s=e.find(".content-body");d.removeClass("d-none"),s.addClass("d-none"),s.html('<div class="table-responsive"><table class="table table-hover" id="loadTableSummary"><thead><tr><th>Shipper</th><th>Origin</th><th>Destination</th><th>Driver</th><th>Truck#</th>'+("carrier"!==guard?"<th>Carrier</th>":"")+"</tr></thead><tbody></tbody></table></div>");const o=$("#loadTableSummary").find("tbody");var n;r.text(`${n=t.status,n.charAt(0).toUpperCase()+n.slice(1)}`);let i="";t.data.forEach((t=>{i+=`<tr><td>${t.shipper.name}</td><td>${t.origin}</td><td>${t.destination}</td><td>${t.driver?t.driver.name:""}</td><td>${t.truck?t.truck.number:""}</td>`+("carrier"!==guard?`<td>${t.driver?t.driver.carrier.name:""}</td></tr>`:"")})),o.html(i),d.addClass("d-none"),s.removeClass("d-none"),a.modal("show")})(e)})),void 0!==window.Echo&&window.Echo.private("load-status-update").listen("LoadUpdate",(a=>{const r=a.load,e=r.status;let d=null,s=null;if(t.forEach(((t,a)=>{const e=t.data.findIndex((t=>Number(t.id)===Number(r.id)));if(-1!==e)return s=e,d=a,!1})),null!==s){const a=t[d],r=a.status;if(r===e)return!1;a.data.splice(s,1),a.count=a.data.length,$(`#${r}_summary`).text(a.count)}const o=$(`#${e}_summary`),n=t.find((t=>t.status===e));o.text(Number(o.text())+1),n?n.data.push(r):t.push({status:e,count:1,data:[r]})}))})();

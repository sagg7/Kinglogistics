(()=>{const t=$("[name=shipper]"),e=$("[name=trips]"),r=$("[name=driver]");let a=null,d=null,n=null;const s=[],o=$("#loads-summary").find("table"),i=[],l=()=>{o.find("h2").text(0),$.ajax({url:"/dashboard/getData",type:"GET",data:{shipper:a,trip:d,driver:n},success:t=>{if(t.loads&&(Object.entries(t.loads).forEach((t=>{const[e,a]=t;$(`#${e}_summary`).text(a.count),s.push({status:e,count:a.count,data:a.data}),r.is(":empty")&&a.data.forEach((t=>{const e=t.driver?i.find((e=>Number(e.id)===Number(t.driver.id))):null;e||null===e||i.push({id:t.driver.id,name:t.driver.name})}))})),r.is(":empty"))){i.sort(((t,e)=>t.id>e.id?1:e.id>t.id?-1:0));let t="<option></option>";i.forEach((e=>{t+=`<option value="${e.id}">${e.name}</option>`})),r.html(t)}},error:()=>{throwErrorMsg()}})};t.select2({ajax:{url:"/shipper/selection",data:t=>({search:t.term,page:t.page||1,take:15})},placeholder:"Select",allowClear:!0}).on("select2:select",(t=>{a=t.params.data.id,s.length=0,l()})).on("select2:unselect",(t=>{a=null,l()})),e.select2({ajax:{url:"/trip/selection",data:e=>({search:e.term,page:e.page||1,take:15,shipper:t.val()})},placeholder:"Select",allowClear:!0}).on("select2:select",(t=>{d=t.params.data.id,s.length=0,l()})).on("select2:unselect",(t=>{d=null,l()})),r.select2({placeholder:"Select",allowClear:!0}).on("select2:select",(t=>{n=t.params.data.id,s.length=0,l()})).on("select2:unselect",(t=>{n=null,l()})),l();const h=t=>{const e=$("#viewLoadStatus"),r=e.find(".modal-title"),a=e.find(".modal-body"),d=a.find(".modal-spinner"),n=a.find(".content-body");d.removeClass("d-none"),n.addClass("d-none"),n.html('<div class="table-responsive"><table class="table table-hover" id="loadTableSummary"><thead><tr>'+("shipper"!==guard?"<th>Shipper</th>":"")+"<th>Origin</th><th>Destination</th><th>Driver</th><th>Truck#</th>"+("carrier"!==guard?"<th>Carrier</th>":"")+"</tr></thead><tbody></tbody></table></div>");const s=$("#loadTableSummary").find("tbody");var o;r.text(`${o=t.status,o.charAt(0).toUpperCase()+o.slice(1)}`);let i="";const l=[];t.data.forEach(((t,e)=>{const r=`row_${e}`;l.push(r),i+=`<tr class="cursor-pointer" id="${r}">`+("shipper"!==guard?`<td>${t.shipper.name}</td>`:"")+`<td>${t.origin}</td>`+`<td>${t.destination}</td>`+`<td>${t.driver?t.driver.name:""}</td>`+`<td>${t.truck?t.truck.number:""}</td>`+("carrier"!==guard?`<td>${t.driver?t.driver.carrier.name:""}</td></tr>`:"")})),s.html(i),l.forEach(((e,r)=>{$(`#${e}`).click((()=>{(t=>{const e=$("#viewLoad"),r=e.find(".modal-body"),a=r.find(".modal-spinner"),d=r.find(".content-body");a.removeClass("d-none"),d.addClass("d-none"),d.html('<div class="table-responsive"><table class="table"><thead><tr>'+("shipper"!==guard?"<th>Shipper</th>":"")+"<th>Driver</th><th>Truck#</th>"+("carrier"!==guard?"<th>Carrier</th>":"<th></th>")+("shipper"===guard?"<th></th>":"")+"</tr></thead><tbody><tr>"+("shipper"!==guard?`<td>${t.shipper.name}</td>`:"")+`<td>${t.driver?t.driver.name:""}</td>`+`<td>${t.truck?t.truck.number:""}</td>`+("carrier"!==guard?`<td>${t.driver?t.driver.carrier.name:""}</td>`:"<td></td>")+"</tr><tr><th>Load type</th><th>Date</th><th>Origin</th><th>Destination</th></tr><tr>"+`<td>${t.load_type?t.load_type.name:""}</td>`+`<td>${t.date?t.date:""}</td>`+`<td>${t.origin?t.origin:""}</td>`+`<td>${t.destination?t.destination:""}</td></tr><tr><th>Control#</th><th>Customer name</th><th>Customer po</th><th>Customer reference</th></tr><tr>`+`<td>${t.control_number?t.control_number:""}</td>`+`<td>${t.customer_name?t.customer_name:""}</td>`+`<td>${t.customer_po?t.customer_po:""}</td>`+`<td>${t.customer_reference?t.customer_reference:""}</td></tr><tr><th>Weight</th><th>Tons</th><th>Silo number</th><th>Mileage</th></tr><tr>`+`<td>${t.weight?t.weight:""}</td>`+`<td>${t.tons?t.tons:""}</td>`+`<td>${t.silo_number?t.silo_number:""}</td>`+`<td>${t.mileage?t.mileage:""}</td></tr></tbody></table></div>`),a.addClass("d-none"),d.removeClass("d-none"),e.modal("show")})(t.data[r])}))})),d.addClass("d-none"),n.removeClass("d-none"),e.modal("show")};$('[id*="_summary"]').click((t=>{t.preventDefault(),t.stopPropagation();const e=$(t.currentTarget).attr("id").split("_summary")[0],r=s.find((t=>t.status===e));r&&h(r)})),void 0!==window.Echo&&window.Echo.private("load-status-update").listen("LoadUpdate",(t=>{const e=t.load,r=e.status;let a=null,d=null;if(s.forEach(((t,r)=>{const n=t.data.findIndex((t=>Number(t.id)===Number(e.id)));if(-1!==n)return d=n,a=r,!1})),null!==d){const t=s[a],e=t.status;if(e===r)return!1;t.data.splice(d,1),t.count=t.data.length,$(`#${e}_summary`).text(t.count)}const n=$(`#${r}_summary`),o=s.find((t=>t.status===r));n.text(Number(n.text())+1),o?o.data.push(e):s.push({status:r,count:1,data:[e]})}))})();

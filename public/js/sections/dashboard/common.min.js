const loadSummary=[];(()=>{$.ajax({url:"/dashboard/getData",type:"GET",success:t=>{t.loads&&Object.entries(t.loads).forEach((t=>{const[a,r]=t,d=new CountUp(`${a}_summary`,r.count);d.error?console.error(d.error):d.start(),loadSummary.push({status:a,count:r.count,data:r.data})}))},error:()=>{throwErrorMsg()}});$('[id*="_summary"]').click((t=>{t.preventDefault(),t.stopPropagation();const a=$(t.currentTarget).attr("id").split("_")[0],r=loadSummary.find((t=>t.status===a));r&&(t=>{const a=$("#viewLoadStatus"),r=a.find(".modal-title"),d=a.find(".modal-body"),e=d.find(".modal-spinner"),o=d.find(".content-body");e.removeClass("d-none"),o.addClass("d-none"),o.html('<div class="table-responsive"><table class="table table-hover" id="loadTableSummary"><thead><tr><th>Shipper</th><th>Origin</th><th>Destination</th><th>Driver</th><th>Truck#</th>'+("carrier"!==guard?"<th>Carrier</th>":"")+"</tr></thead><tbody></tbody></table></div>");const s=$("#loadTableSummary").find("tbody");var n;r.text(`${n=t.status,n.charAt(0).toUpperCase()+n.slice(1)}`);let i="";t.data.forEach((t=>{i+=`<tr><td>${t.shipper.name}</td><td>${t.origin}</td><td>${t.destination}</td><td>${t.driver?t.driver.name:""}</td><td>${t.truck?t.truck.number:""}</td>`+("carrier"!==guard?`<td>${t.driver?t.driver.carrier.name:""}</td></tr>`:"")})),s.html(i),e.addClass("d-none"),o.removeClass("d-none"),a.modal("show")})(r)})),void 0!==window.Echo&&window.Echo.private("load-status-update").listen("LoadUpdate",(t=>{const a=t.load,r=a.status;let d=null,e=null;if(loadSummary.forEach(((t,r)=>{const o=t.data.findIndex((t=>Number(t.id)===Number(a.id)));if(-1!==o)return e=o,d=r,!1})),null!==e){const t=loadSummary[d],a=t.status;if(a===r)return!1;t.data.splice(e,1),t.count=t.data.length,$(`#${a}_summary`).text(t.count)}const o=$(`#${r}_summary`),s=loadSummary.find((t=>t.status===r));o.text(Number(o.text())+1),s?s.data.push(a):loadSummary.push({status:r,count:1,data:[a]})}))})();

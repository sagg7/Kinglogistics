(()=>{let e=null,t=null,a=[];const i=$("#dateRange"),r=e=>e.value?`${e.value}h`:"",d=new simpleTableAG({id:"dataTable",columns:[{headerName:"Truck",field:"truck"},{headerName:"Driver",field:"driver"},{headerName:"Carrier",field:"carrier"},{headerName:"Waiting time",field:"waiting_time",valueFormatter:r},{headerName:"Active load time",field:"loaded_time",valueFormatter:r},{headerName:"Active time",field:"active_time",valueFormatter:r},{headerName:"Inactive time",field:"inactive_time",valueFormatter:r}],rowData:a,gridOptions:{components:{tableRef:"driversTable"}},autoHeight:!0}),n=(r=i.data().daterangepicker.startDate,n=i.data().daterangepicker.endDate)=>{$.ajax({url:"/report/activeTimeData",type:"GET",data:{start:r.format("YYYY/MM/DD"),end:n.format("YYYY/MM/DD")},success:i=>{a=[];let r=[];i.driversData.forEach((e=>{const t=i.carriersData.find((t=>t.id===e.carrier_id));a.push({truck:e.truck?e.truck.number:"",driver:e.name,carrier:t.name,waiting_time:e.waiting_time.toFixed(2),active_time:e.active_time.toFixed(2),inactive_time:e.inactive_time.toFixed(2),loaded_time:e.loaded_time.toFixed(2)}),r.push({name:e.name,data:[e.active_time.toFixed(2)]})}));let n=[];const o=[],s=[];i.carriersData.forEach((e=>{n.push(e.name),o.push(e.active_time.toFixed(2)),s.push(e.trucks)}));const c=[{name:"Active time",data:o,type:"bar"},{name:"Active trucks",data:s,type:"line"}];(t=>{const a={series:t,chart:{height:350,type:"bar"},title:{text:"Drivers Active Time"},plotOptions:{bar:{horizontal:!1,endingShape:"flat",columnWidth:"55%"}},dataLabels:{enabled:!0},stroke:{show:!0,width:2,colors:["transparent"]},legend:{offsetY:-10},xaxis:{categories:[""]},yaxis:[{title:{text:"Active time"}}],fill:{opacity:1},tooltip:{y:{formatter:function(e){return Number(e)}}}};e?e.updateOptions(a):(e=new ApexCharts(document.querySelector("#driversChart"),a),e.render())})(r),((e,a)=>{const i={series:e,chart:{height:350,type:"line"},stroke:{width:[0,4]},title:{text:"Carriers Active Time"},dataLabels:{enabled:!0,enabledOnSeries:[1]},labels:a,yaxis:[{title:{text:"Active time"}},{opposite:!0,title:{text:"Active trucks"}}]};t?t.updateOptions(i):(t=new ApexCharts(document.querySelector("#carriersChart"),i),t.render())})(c,n),d.rowData=a,d.gridOptions.api.setRowData(a),d.gridOptions.api.sizeColumnsToFit()}})};i.daterangepicker({format:"YYYY/MM/DD",startDate:moment().startOf("week"),endDate:moment().endOf("week")},((e,t,a)=>{n(e,t)})),n()})();

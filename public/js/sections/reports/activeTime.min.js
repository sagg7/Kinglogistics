(()=>{let e=null,t=null,a=[];const i=$("#dateRange"),r=$("[name=carrier]"),c=e=>e.value?`${e.value}h`:"",d=new simpleTableAG({id:"dataTable",columns:[{headerName:"Truck",field:"truck"},{headerName:"Driver",field:"driver"},{headerName:"Carrier",field:"carrier"},{headerName:"Waiting time",field:"waiting_time",valueFormatter:c},{headerName:"Active load time",field:"loaded_time",valueFormatter:c},{headerName:"Active time",field:"active_time",valueFormatter:c},{headerName:"Inactive time",field:"inactive_time",valueFormatter:c}],rowData:a,gridOptions:{components:{tableRef:"driversTable"}},autoHeight:!0}),s=(c=i.data().daterangepicker.startDate,s=i.data().daterangepicker.endDate)=>{$.ajax({url:"/report/activeTimeData",type:"GET",data:{start:c.format("YYYY/MM/DD"),end:s.format("YYYY/MM/DD"),carrier:r.val()},success:i=>{a=[];let r=[],c=[];i.driversData.forEach((e=>{const t=i.carriersData.find((t=>t.id===e.carrier_id));a.push({truck:e.truck?e.truck.number:"",driver:e.name,carrier:t.name,waiting_time:e.waiting_time.toFixed(2),active_time:e.active_time.toFixed(2),inactive_time:e.inactive_time.toFixed(2),loaded_time:e.loaded_time.toFixed(2)}),r.push(e.active_time.toFixed(2)),c.push(e.name)}));let s=[];const n=[],l=[];i.carriersData.forEach((e=>{s.push(e.name),n.push(e.active_time.toFixed(2)),l.push(e.trucks)}));const m=[{name:"Active time",data:n,type:"bar"},{name:"Active trucks",data:l,type:"line"}];(t=>{const a=_.merge({chart:{height:350,type:"bar"},title:{text:"Drivers Active Time"},dataLabels:{enabled:!0},legend:{offsetY:-10},xaxis:{categories:[""]},yaxis:[{title:{text:"Active time"}}],tooltip:{y:{formatter:function(e){return Number(e)}}}},t);e?e.updateOptions(a):(e=new ApexCharts(document.querySelector("#driversChart"),a),e.render())})({series:[{name:"Active Time",data:r}],xaxis:{categories:c}}),((e,a)=>{const i={series:e,chart:{height:350,type:"line"},stroke:{width:[0,4]},title:{text:"Carriers Active Time"},dataLabels:{enabled:!0,enabledOnSeries:[1]},labels:a,yaxis:[{title:{text:"Active time"}},{opposite:!0,title:{text:"Active trucks"}}]};t?t.updateOptions(i):(t=new ApexCharts(document.querySelector("#carriersChart"),i),t.render())})(m,s),d.rowData=a,d.gridOptions.api.setRowData(a),d.gridOptions.api.sizeColumnsToFit()}})};i.daterangepicker({format:"YYYY/MM/DD",startDate:moment().startOf("week"),endDate:moment().endOf("week")},((e,t,a)=>{s(e,t)})),r.select2({ajax:{url:"/carrier/selection",data:e=>({search:e.term,page:e.page||1,take:15})},placeholder:"Select",allowClear:!0}).on("select2:select",(()=>{s()})).on("select2:unselect",(()=>{s()})),s()})();

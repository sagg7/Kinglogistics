function RemoveBtnRenderer(){}function IvaCheckRenderer(){}function DiscountInputRenderer(){}RemoveBtnRenderer.prototype.deleteFunction=((e,t,i)=>{_.pull(window[e].rowData,_.find(window[e].rowData,{id:t,type:i})),window[e].gridOptions.api.setRowData(window[e].rowData),window[e].gridOptions.api.setPinnedBottomRowData(window[e].pinnedBottomFunction(window[e])),window[e].onRemoveRow&&window[e].onRemoveRow()}),RemoveBtnRenderer.prototype.init=(e=>{!1!==e.value?(this.eGui=document.createElement("span"),this.eGui.className="d-inline-block",this.eGui.innerHTML='<button type="button" class="btn btn-link btn-remove"><i class="feather icon-x"></i></button>',$(this.eGui).click(function(t){t.preventDefault(),RemoveBtnRenderer.prototype.deleteFunction(e.api.gridCore.gridOptions.components.tableRef,e.data.id,e.data.type)})):this.eGui=null}),RemoveBtnRenderer.prototype.getGui=(()=>this.eGui),IvaCheckRenderer.prototype.toggleIva=((e,t,i)=>{e.enableIva=i,t.setPinnedBottomRowData(e.pinnedBottomFunction(e))}),IvaCheckRenderer.prototype.init=(e=>{let t=e.api.gridCore.gridOptions.components.tableRef,i=window[t];e.data.renderIva?(this.eGui=document.createElement("fieldset"),this.eGui.className="form-group pull-right",this.eGui.innerHTML='<div class="vs-checkbox-con vs-checkbox-primary">'+`<input type="checkbox" value="true" id="ivaCheck" ${i.enableIva?"checked":""}>`+'<span class="vs-checkbox"><span class="vs-checkbox--check"><i class="vs-icon feather icon-check"></i></span></span>'+`<label for="ivaCheck">${e.value}</label>`+"</div>",$(this.eGui).find("input").click(function(t){IvaCheckRenderer.prototype.toggleIva(i,e.api,$(t.currentTarget).is(":checked"))})):(this.eGui=document.createElement("span"),this.eGui.innerHTML=e.value)}),IvaCheckRenderer.prototype.getGui=(()=>this.eGui),DiscountInputRenderer.prototype.calculateDiscount=((e,t,i)=>{i=Number(i),e.rowData.forEach((t,n)=>{e.rowData[n].discount=i;let o=Number(t.quantity)*Number(t.price);e.rowData[n].total=o-Number(i*o/100).toFixed(2)}),e.generalDiscount=i,t.setRowData(e.rowData),t.setPinnedBottomRowData(e.pinnedBottomFunction(e))}),DiscountInputRenderer.prototype.init=(e=>{let t=e.api.gridCore.gridOptions.components.tableRef,i=window[t];if(e.data.renderDiscInp){this.eGui=document.createElement("div"),this.eGui.className="d-flex align-items-center",this.eGui.innerHTML=`<div class="input-group"><div class="input-group-prepend"><span class="input-group-text">%</span></div><input type="text" class="form-control" value="${i.generalDiscount}"></div>`+`<span class="">&nbsp;= $${e.value}</span>`;let t=t=>{let n=Number(t.val());if(isNaN(n))return t.val(0),!1;n>100&&(n=100,t.val(n)),DiscountInputRenderer.prototype.calculateDiscount(i,e.api,n)};$(this.eGui).find("input").focus(e=>{let t=$(e.currentTarget);0===Number(t.val())&&t.val("")}).focusout(e=>{let i=$(e.currentTarget);t(i)})}else this.eGui=document.createElement("span"),this.eGui.innerHTML=numeral(e.value).format("$0,0.00")}),DiscountInputRenderer.prototype.getGui=(()=>this.eGui);class AgGridFront{constructor(e){this.validationFunction=e.validationFunction,this.pinnedBottomFunction=e.pinnedBottomFunction?e.pinnedBottomFunction:this.totalRows,this.onTotalCalc=e.onTotalCalc,this.onRemoveRow=e.onRemoveRow,this.enableIva=!1,this.id=e.id,this.columns=e.columns,this.columnDefs=[],this.iva_percentage=e.iva_percentage||0===e.iva_percentage?e.iva_percentage:16,0!==this.iva_percentage&&(this.enableIva=!0),this.hasDiscount=!!e.hasDiscount&&e.hasDiscount,this.generalDiscount=e.generalDiscount?e.generalDiscount:0,this.constructColumns();let t=this.columnDefs,i=this.rowData=e.rowData?e.rowData:[];this.gridOptions={columnDefs:t,rowData:i,rowDragManaged:!0,animateRows:!0,pagination:!1,stopEditingWhenGridLosesFocus:!0,pinnedBottomRowData:this.pinnedBottomFunction(this),localeText:{noRowsToShow:"No hay elementos para mostrar"},defaultColDef:{flex:1,minWidth:100,sortable:!0,resizable:!0},components:{RemoveBtnRenderer:RemoveBtnRenderer,IvaCheckRenderer:IvaCheckRenderer,DiscountInputRenderer:DiscountInputRenderer},onGridReady:function(e){e.api.sizeColumnsToFit();let t,i=!1,n=450;function o(){new Date-t<n?setTimeout(o,n):(i=!1,e.api.sizeColumnsToFit())}window.addEventListener("resize",function(){t=new Date,!1===i&&(i=!0,setTimeout(o,n))})},onCellEditingStopped:e=>{let t=e.data,i=this.rowData.findIndex(e=>e.id===t.id&&e.type===t.type);if(this.validationFunction){let e=this.validationFunction(t);e.validation||(this.rowData[i].quantity=e.value)}if("discount"===e.colDef.field){let t=0;Number(e.value)>100?t=100:isNaN(e.value)||(t=Number(e.value)),this.rowData[i].discount=t,this.generalDiscount=0}let n=Number(t.quantity)*Number(t.price);this.hasDiscount?this.rowData[i].total=n-Number((Number(this.rowData[i].discount)*n/100).toFixed(2)):this.rowData[i].total=n,this.grid.gridOptions.api.setRowData(this.rowData),this.grid.gridOptions.api.setPinnedBottomRowData(this.pinnedBottomFunction(this))},onRowDragEnd:e=>{let t=Object.values(e.api.rowRenderer.rowCompsByIndex),i=[];t.forEach((e,t)=>{let n=e.rowNode.data,o=this.rowData.findIndex(e=>e.id===n.id&&e.type===n.type);i.push(this.rowData[o])}),this.rowData=i}},"object"==typeof e.gridOptions&&null!==e.gridOptions&&_.merge(this.gridOptions,e.gridOptions),this.init()}constructColumns(){this.columns.forEach((e,t)=>{(this.hasDiscount?3===t:2===t)?(e.cellRenderer="IvaCheckRenderer",e.cellStyle=function(e){if(!e.data.renderIva&&isNaN(e.value))return{pointerEvents:"none"}}):this.hasDiscount?4===t&&(e.cellRenderer="DiscountInputRenderer"):e.cellStyle=function(e){if(!e.value)return{pointerEvents:"none"}},"discount"===e.field&&(e.cellRenderer=this.calculateDiscount),this.columnDefs.push(e)}),this.columnDefs.push({headerName:"",field:"remove",cellRenderer:"RemoveBtnRenderer",width:70,maxWidth:70,minWidth:70,cellStyle:{padding:0}})}calculateDiscount(e){if(isNaN(e.value))return e.value;let t=Number(e.data.quantity)*Number(e.data.price);return numeral(Number(e.value)*t/100).format("$0,0.00")}totalRows(e){let t=0,i=0,n=0,o=0;e.rowData.forEach(e=>{let n=Number(e.quantity)*Number(e.price);e.discount&&(i+=Number((Number(e.discount)*n/100).toFixed(2))),t+=n}),o+=t-i,e.enableIva&&(n+=o*(e.iva_percentage/100)),e.onTotalCalc&&e.onTotalCalc({total:o,iva:n});let a,r=[];return a={description:"",quantity:"",price:"Subtotal",total:t,remove:!1},e.hasDiscount&&(a.price="",a.discount="Subtotal"),r.push(a),0!==e.iva_percentage&&(a={description:"",quantity:"",price:"IVA",total:n,remove:!1,renderIva:!0,checkedIva:e.enableIva},e.hasDiscount&&(a.price="",a.discount="IVA"),r.push(a)),(i>0||e.hasDiscount)&&(a={description:"",quantity:"",price:"",discount:"",total:i,remove:!1,renderDiscInp:!0},e.hasDiscount?a.discount="Descuento":a.price="Descuento",r.push(a)),a={description:"",quantity:"",price:"Total",total:o+n,remove:!1},e.hasDiscount&&(a.price="",a.discount="Total"),r.push(a),r}init(){let e=document.querySelector(`#${this.id}`);this.grid=new agGrid.Grid(e,this.gridOptions),$(".modern-nav-toggle").click(()=>{setTimeout(()=>{this.grid.gridOptions.api.sizeColumnsToFit()},500)})}}

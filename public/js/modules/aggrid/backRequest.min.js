function OptionsRenderer(){}OptionsRenderer.prototype.guidGenerator=(()=>{let e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}),OptionsRenderer.prototype.deleteFunction=((e,t)=>{Swal.fire({title:"Confirmación para eliminar elemento",showCancelButton:!0,confirmButtonText:"Confirmar",cancelButtonText:"Cancelar",confirmButtonColor:"#7367F0",cancelButtonColor:"#EA5455",allowOutsideClick:()=>!Swal.isLoading()}).then(i=>{i.value&&$.ajax({url:e,type:"POST",success:e=>{e.success?window[t].updateSearchQuery():throwErrorMsg(e.msg)},error:()=>{throwErrorMsg()}})})}),OptionsRenderer.prototype.init=(e=>{this.eGui=document.createElement("div");let t=OptionsRenderer.prototype.guidGenerator(),i=`<button class="btn waves-effect waves-light" data-toggle="popover" data-placement="top" data-container="body" id="pop-${t}"><i class="fa fa-bars"></i></button>`,n='<ul class="list-group list-group-flush">';e.colDef.menuData.forEach(t=>{"delete"===t.type?n+=`<li class="list-group-item p-0"><a class="btn-link d-block p-1 delete" href="${t.route}/${e.data.id}"><i class="feather icon-trash-2"></i> Eliminar</a></li>`:t.modal?n+=`<li class="list-group-item p-0"><a class="btn-link d-block p-1 open-modal" href="${t.route}/${e.data.id}"><i class="${t.icon}"></i> ${t.text}</a></li>`:n+=`<li class="list-group-item p-0"><a class="btn-link d-block p-1" href="${t.route}/${e.data.id}"><i class="${t.icon}"></i> ${t.text}</a></li>`}),n+="</ul>",this.eGui.innerHTML=i,$(function(){$(`#pop-${t}`).popover({html:!0,content:n}).on("shown.bs.popover",function(t){let i=$(".popover"),n=i.find(".delete");i.find(".open-modal").click(t=>{let i=$(t.currentTarget).attr("href").split("/"),n=i[0],s=i[1];e.api.gridCore.gridOptions.components.OptionModalFunc(n,s)}),n.click(function(t){t.preventDefault(),OptionsRenderer.prototype.deleteFunction(n.attr("href"),e.api.gridCore.gridOptions.components.tableRef)})})})}),OptionsRenderer.prototype.getGui=(()=>this.eGui);class DataSource{constructor(e){this.url=e.url,this.params=e.params,this.ajax=null,this.successCallback=e.successCallback}getRows(e){let t=e.request;if(this.params){let i=[];e.columnApi.columnController.columnDefs.forEach(e=>{!1!==e.filter&&i.push(e.field)}),t={...t,...this.params,searchable:i}}this.ajax=$.ajax({url:this.url,data:t,type:"GET",beforeSend:()=>{null!==this.ajax&&this.ajax.abort()},success:t=>{e.successCallback(t.rows,t.lastRow),this.successCallback&&this.successCallback(t)},error:()=>{e.failCallback()},always:()=>{this.ajax=null}})}}class tableAG{constructor(e){this.columns=e.columns,this.columnDefs=[],this.renderSimple=void 0!==e.renderSimple&&e.renderSimple,this.successCallback=void 0!==e.successCallback?e.successCallback:null,this.menu=e.menu,this.constructColumns(),this.page=0;let t=this.columnDefs;this.gridOptions={columnDefs:t,rowSelection:"multiple",pagination:!0,paginationPageSize:15,cacheBlockSize:30,rowModelType:"serverSide",pivotPanelShow:"always",colResizeDefault:"shift",animateRows:!0,components:{OptionsRenderer:OptionsRenderer,OptionModalFunc:null,tableRef:e.tableRef},defaultColDef:{flex:1,minWidth:100,sortable:!0,resizable:!0,menuTabs:["filterMenuTab"]},localeText:this.constructLocale(),onGridReady:function(t){setTimeout(()=>{t.api.sizeColumnsToFit()},300);let i,n=!1,s=450;function o(){new Date-i<s?setTimeout(o,s):(n=!1,t.api.sizeColumnsToFit())}window.addEventListener("resize",function(){i=new Date,!1===n&&(n=!0,setTimeout(o,s))}),e.autoHeight&&t.api.setDomLayout("autoHeight")}},"object"==typeof e.gridOptions&&null!==e.gridOptions&&_.merge(this.gridOptions,e.gridOptions),this.container=e.container,this.url=e.url,this.pinned=e.pinned,this.init()}constructColumns(){this.columns.forEach((e,t)=>{let i=e;!1!==e.filter&&(i={filter:"agTextColumnFilter",filterParams:{resetButton:!0,debounceMs:1e3,suppressAndOrCondition:!0},...e}),this.columnDefs.push(i)}),this.renderSimple||this.columnDefs.push({headerName:"Opciones",width:120,field:"options",filter:!1,sortable:!1,cellRenderer:"OptionsRenderer",menuData:this.menu})}constructHtml(){let e="<section>";return this.renderSimple||(e+='<div class="row"><div class="col-12 p-0"><div class="ag-grid-btns d-flex justify-content-between flex-wrap mb-1"><div class="dropdown sort-dropdown mb-1 mb-sm-0"><button class="btn btn-white filter-btn dropdown-toggle border text-dark" type="button" id="agDropSize" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'+`Mostrar ${this.gridOptions.paginationPageSize}`+'</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="agDropSize">'+`<a class="dropdown-item" href="#">${this.gridOptions.paginationPageSize}</a>`+'<a class="dropdown-item" href="#">50</a><a class="dropdown-item" href="#">100</a><a class="dropdown-item" href="#">150</a></div></div><div class="ag-btns d-flex flex-wrap"><div class="input-group"><input type="text" class="ag-grid-filter form-control mb-1 mb-sm-0" id="filter-text-box" placeholder="Buscar...." /><div class="input-group-append"><button class="btn btn-primary waves-effect waves-light" type="button"><i class="feather icon-search"></i></button></div></div></div></div></div>'),e+=`<div id="${this.container}" class="aggrid ag-theme-material w-100"`+"</section>"}constructLocale(){return{page:"Página",more:"Más",to:"a",of:"de",next:"Siguente",last:"Último",first:"Primero",previous:"Anterior",loadingOoo:"Cargando...",filterOoo:"Filtro...",equals:"Igual",notEqual:"Desigual",contains:"Contiene",notContains:"No contiene",startsWith:"Empieza con",endsWith:"Termina con",applyFilter:"Aplicar",resetFilter:"Restablecer filtro",clearFilter:"Limpiar"}}updateSearchQuery(e){let t={url:this.url};""!==e&&(t.params={search:e});let i=new DataSource(t);this.gridOptions.api.setServerSideDatasource(i)}changePageSize(e){this.gridOptions.api.paginationSetPageSize(Number(e)),this.gridOptions.api.sizeColumnsToFit()}init(){let e=document.querySelector(`#${this.container}`);e.id="",e.innerHTML=this.constructHtml();let t=document.querySelector(`#${this.container}`),i=$(".ag-grid-filter");i.on("keyup",e=>{13===e.which&&this.updateSearchQuery(i.val())}),i.parent().find("button").click(()=>{this.updateSearchQuery(i.val())}),$(".sort-dropdown .dropdown-item").on("click",e=>{let t=$(e.target);this.changePageSize(t.text()),$(".filter-btn").text("Mostrar "+t.text())}),$(".ag-grid-export-btn").on("click",e=>{this.gridOptions.api.exportDataAsCsv()}),new agGrid.Grid(t,this.gridOptions),this.gridOptions.api.sizeColumnsToFit(),$(window).width()<768?this.gridOptions.columnApi.setColumnPinned(this.pinned,null):this.gridOptions.columnApi.setColumnPinned(this.pinned,"left"),$(window).on("resize",()=>{$(window).width()<768?this.gridOptions.columnApi.setColumnPinned(this.pinned,null):this.gridOptions.columnApi.setColumnPinned(this.pinned,"left")});let n=new DataSource({url:this.url,successCallback:this.successCallback});this.gridOptions.api.setServerSideDatasource(n)}}

function OptionsRenderer(){}OptionsRenderer.prototype.guidGenerator=()=>{let t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},OptionsRenderer.prototype.confirmationFunction=(t,e,i)=>{Swal.fire({title:i.title,showCancelButton:!0,confirmButtonText:"Confirm",cancelButtonText:"Cancel",confirmButtonColor:"#7367F0",cancelButtonColor:"#EA5455",allowOutsideClick:()=>!Swal.isLoading()}).then((i=>{i.value&&$.ajax({url:t,type:"POST",success:t=>{t.success?window[e].updateSearchQuery():throwErrorMsg(t.msg)},error:()=>{throwErrorMsg()}})}))},OptionsRenderer.prototype.deleteFunction=(t,e)=>{OptionsRenderer.prototype.confirmationFunction(t,e,{title:"Confirmation to delete item"})},OptionsRenderer.prototype.init=t=>{this.eGui=document.createElement("div");let e=OptionsRenderer.prototype.guidGenerator(),i=`<button class="btn waves-effect waves-light" data-toggle="popover" data-placement="top" data-container="body" id="pop-${e}"><i class="fa fa-bars"></i></button>`,n='<ul class="list-group list-group-flush">',o={};t.colDef.menuData.forEach((e=>{if(e.type){let i="",s="",r="";switch(e.type){case"delete":i="delete",r="Delete",s="feather icon-trash-2";break;case"confirm":i="confirm",r=e.text,s=e.icon}o=e.menuData,n+=`<li class="list-group-item p-0"><a class="btn-link d-block p-1 ${i}" href="${e.route}/${t.data.id}"><i class="${s}"></i> ${r}</a></li>`}else e.modal?n+=`<li class="list-group-item p-0"><a class="btn-link d-block p-1 open-modal" href="${e.route}/${t.data.id}"><i class="${e.icon}"></i> ${e.text}</a></li>`:n+=`<li class="list-group-item p-0"><a class="btn-link d-block p-1" href="${e.route}/${t.data.id}"><i class="${e.icon}"></i> ${e.text}</a></li>`})),n+="</ul>",this.eGui.innerHTML=i,$((function(){$(`#pop-${e}`).popover({html:!0,content:n,trigger:"focus"}).on("shown.bs.popover",(function(e){let i=$(".popover"),n=i.find(".delete"),s=i.find(".confirm");i.find(".open-modal").click((e=>{let i=$(e.currentTarget).attr("href").split("/"),n=i[0],o=i[1];t.api.gridCore.gridOptions.components.OptionModalFunc(n,o)})),n.click((function(e){e.preventDefault(),OptionsRenderer.prototype.deleteFunction(n.attr("href"),t.api.gridCore.gridOptions.components.tableRef)})),s.click((e=>{e.preventDefault(),OptionsRenderer.prototype.confirmationFunction(s.attr("href"),t.api.gridCore.gridOptions.components.tableRef,o)}))}))}))},OptionsRenderer.prototype.getGui=()=>this.eGui;class DataSource{constructor(t){this.url=t.url,this.params=t.params,this.ajax=null,this.successCallback=t.successCallback}getRows(t){let e=t.request;if(this.params){let i=[];t.columnApi.columnController.columnDefs.forEach((t=>{!1!==t.filter&&i.push(t.field)})),e={...e,...this.params,searchable:i}}this.ajax=$.ajax({url:this.url,data:e,type:"GET",beforeSend:()=>{null!==this.ajax&&this.ajax.abort()},success:e=>{t.successCallback(e.rows,e.lastRow),this.successCallback&&this.successCallback(e)},error:()=>{t.failCallback()},always:()=>{this.ajax=null}})}}class tableAG{constructor(t){this.columns=t.columns,this.columnDefs=[],this.renderSimple=void 0!==t.renderSimple&&t.renderSimple,this.successCallback=void 0!==t.successCallback?t.successCallback:null,this.menu=t.menu,this.constructColumns(),this.page=0;let e=this.columnDefs;this.gridOptions={columnDefs:e,rowSelection:"multiple",pagination:!0,paginationPageSize:15,cacheBlockSize:30,rowModelType:"serverSide",pivotPanelShow:"always",colResizeDefault:"shift",animateRows:!0,components:{OptionsRenderer,OptionModalFunc:null,tableRef:t.tableRef},defaultColDef:{flex:1,minWidth:100,sortable:!0,resizable:!0,menuTabs:["filterMenuTab"]},onGridReady:function(e){setTimeout((()=>{e.api.sizeColumnsToFit()}),300);let i,n=!1;function o(){new Date-i<450?setTimeout(o,450):(n=!1,e.api.sizeColumnsToFit())}window.addEventListener("resize",(function(){i=new Date,!1===n&&(n=!0,setTimeout(o,450))})),t.autoHeight&&e.api.setDomLayout("autoHeight")}},"object"==typeof t.gridOptions&&null!==t.gridOptions&&_.merge(this.gridOptions,t.gridOptions),this.container=t.container,this.url=t.url,this.pinned=t.pinned,this.init()}constructColumns(){this.columns.forEach(((t,e)=>{let i=t;!1!==t.filter&&(i={filter:"agTextColumnFilter",filterParams:{resetButton:!0,debounceMs:1e3,suppressAndOrCondition:!0},...t}),this.columnDefs.push(i)})),this.renderSimple||this.columnDefs.push({headerName:"Menu",width:50,field:"options",filter:!1,sortable:!1,cellRenderer:"OptionsRenderer",menuData:this.menu})}constructHtml(){let t="<section>";return this.renderSimple||(t+=`<div class="row"><div class="col-12 p-0"><div class="ag-grid-btns d-flex justify-content-between flex-wrap mb-1"><div class="dropdown sort-dropdown mb-1 mb-sm-0"><button class="btn btn-white dropdown-toggle border text-dark filter-btn" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Show ${this.gridOptions.paginationPageSize}</button><div class="dropdown-menu dropdown-menu-right"><a class="dropdown-item" href="#">${this.gridOptions.paginationPageSize}</a><a class="dropdown-item" href="#">50</a><a class="dropdown-item" href="#">100</a><a class="dropdown-item" href="#">150</a></div></div><div class="ag-btns d-flex flex-wrap"><div class="input-group"><input type="text" class="ag-grid-filter form-control mb-1 mb-sm-0" placeholder="Search...." /><div class="input-group-append"><button class="btn btn-primary pl-1 pr-1 waves-effect waves-light" type="button"><i class="fa fa-search"></i></button></div></div></div></div></div>`),t+=`<div id="${this.container}" class="aggrid ag-theme-material w-100"</section>`,t}updateSearchQuery(t){let e={url:this.url};""!==t&&(e.params={search:t});let i=new DataSource(e);this.gridOptions.api.setServerSideDatasource(i)}changePageSize(t){this.gridOptions.api.paginationSetPageSize(Number(t)),this.gridOptions.api.sizeColumnsToFit()}init(){let t=document.querySelector(`#${this.container}`);t.id="",t.innerHTML=this.constructHtml();let e=document.querySelector(`#${this.container}`);const i=$(`#${this.container}`).closest("section");let n=i.find(".ag-grid-filter");n.on("keyup",(t=>{13===t.which&&this.updateSearchQuery(n.val())})),n.parent().find("button").click((()=>{this.updateSearchQuery(n.val())})),i.find(".sort-dropdown .dropdown-item").on("click",(t=>{let e=$(t.target);this.changePageSize(e.text()),i.find(".filter-btn").text("Mostrar "+e.text())})),$(".ag-grid-export-btn").on("click",(t=>{this.gridOptions.api.exportDataAsCsv()})),new agGrid.Grid(e,this.gridOptions),this.gridOptions.api.sizeColumnsToFit(),$(window).width()<768?this.gridOptions.columnApi.setColumnPinned(this.pinned,null):this.gridOptions.columnApi.setColumnPinned(this.pinned,"left"),$(window).on("resize",(()=>{$(window).width()<768?this.gridOptions.columnApi.setColumnPinned(this.pinned,null):this.gridOptions.columnApi.setColumnPinned(this.pinned,"left")}));let o=new DataSource({url:this.url,successCallback:this.successCallback});this.gridOptions.api.setServerSideDatasource(o)}}
